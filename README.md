# Clade: è§„åˆ™çº¦æŸä¸‹çš„ AI æ¼”åŒ–æ²™ç›’

**Clade** æ˜¯ä¸€ä¸ªåŸºäºæ··åˆæ¶æ„ï¼ˆHybrid Architectureï¼‰çš„ç”Ÿç‰©æ¼”åŒ–æ¨¡æ‹Ÿç³»ç»Ÿã€‚å®ƒæ—¨åœ¨è§£å†³çº¯ AI æ¨¡æ‹Ÿä¸­å¸¸è§çš„æ•°å€¼å´©åé—®é¢˜ï¼ŒåŒæ—¶çªç ´ä¼ ç»Ÿæ¨¡æ‹Ÿæ¸¸æˆçš„åˆ›æ„ç“¶é¢ˆã€‚

> **æ ¸å¿ƒç†å¿µ**ï¼šç”¨ç¡¬ç¼–ç çš„**ç”Ÿæ€è§„åˆ™**ä¿è¯ç³»ç»Ÿçš„æ•°å€¼å¹³è¡¡ä¸ç¨³å®šæ€§ï¼Œç”¨**å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰**æä¾›æ— é™çš„ç”Ÿç‰©å¤šæ ·æ€§ä¸æ¶Œç°å¼å™äº‹ã€‚

## ğŸŒŸ æ ¸å¿ƒç‰¹æ€§

### 1. ğŸ§  æ··åˆæ¼”åŒ–å¼•æ“ (Hybrid Engine)
ç³»ç»Ÿå°†æ¼”åŒ–è¿‡ç¨‹æ‹†è§£ä¸ºä¸¤ä¸ªç»´åº¦ï¼Œäº’ä¸ºè¡¨é‡Œï¼š
- **æ•°å€¼éª¨æ¶ (The Skeleton - Rules)**ï¼š
  - åŸºäº **å…‹è±ä¼¯å®šå¾‹ (Kleiber's Law)** è®¡ç®—ä»£è°¢ç‡ä¸èƒ½é‡æ¶ˆè€—ã€‚
  - ä¸¥æ ¼çš„ **è¥å…»çº§ (Trophic Levels)** èƒ½é‡ä¼ é€’ä¸æ‰¿è½½åŠ›é™åˆ¶ã€‚
  - åŠ¨æ€çš„ **r/K é€‰æ‹©ç†è®º** å†³å®šç¹æ®–ç­–ç•¥ã€‚
  - **ç‰©ç§åˆ†çº§ (Tiering)**ï¼šæ™ºèƒ½åŒºåˆ†æ ¸å¿ƒç‰©ç§ä¸èƒŒæ™¯ç‰©ç§ï¼Œä¼˜åŒ–ç®—åŠ›åˆ†é…ã€‚
- **å™äº‹è¡€è‚‰ (The Flesh - AI)**ï¼š
  - LLM è´Ÿè´£ç‰©ç§çš„ **å½¢æ€ç”Ÿæˆã€å‘½åã€é€‚åº”æ€§å˜å¼‚**ã€‚
  - ç”Ÿæˆåœ°è´¨å˜è¿çš„ **å²è¯—å™äº‹**ã€‚
  - åˆ›é€ ç‹¬ç‰¹çš„ **ç”Ÿæ€ä½ (Niche)** æè¿°ä¸ç§é—´å…³ç³»ã€‚

### 2. ğŸ—ºï¸ åŠ¨æ€å…­è¾¹å½¢ä¸–ç•Œ
- **126x40 å…­è¾¹å½¢ç½‘æ ¼**ï¼šæ¨¡æ‹ŸçœŸå®çš„å¤§é™†æ¿å—ã€æ´‹æµä¸æ°”å€™å¸¦ã€‚
- **æ¿å—æ„é€ æ¼”åŒ–**ï¼šæ¨¡æ‹Ÿä»â€œç¨³å®šæœŸâ€åˆ°â€œåˆ†è£‚æœŸâ€å†åˆ°â€œç¢°æ’æœŸâ€çš„åœ°è´¨å¾ªç¯ï¼ŒåŠ¨æ€ç”Ÿæˆå±±è„‰ã€æµ·æ²Ÿä¸ç«å±±ã€‚
- **ç¯å¢ƒå‹åŠ›**ï¼šå…¨çƒå˜æš–ã€æµ·å¹³é¢å‡é™ã€æç«¯å¹²æ—±ç­‰äº‹ä»¶å®æ—¶é‡å¡‘åœ°å›¾ã€‚

### 3. ğŸ§¬ æ·±åº¦è°±ç³»è¿½è¸ª
- **äº¤äº’å¼æ—è°±æ ‘**ï¼šå®Œæ•´è®°å½•ç‰©ç§çš„æ¼”åŒ–è·¯å¾„ï¼Œæ¸…æ™°å±•ç¤º **åˆ†åŒ– (Speciation)**ã€**ç­ç» (Extinction)** ä¸ **æ‚äº¤ (Hybridization)** äº‹ä»¶ã€‚
- **é—ä¼ è·ç¦»è®¡ç®—**ï¼šåŸºäºå½¢æ€ä¸åŸºå› ç‰¹å¾è®¡ç®—ç‰©ç§é—´çš„äº²ç¼˜å…³ç³»ï¼Œå†³å®šæ‚äº¤å¯è‚²æ€§ã€‚
- **å™¨å®˜ç³»ç»Ÿ**ï¼šå¯è§†åŒ–çš„ç”Ÿç‰©è“å›¾ï¼Œå±•ç¤ºç‰©ç§çš„è¿›åŒ–ç‰¹å¾ï¼ˆå¦‚â€œå…‰åˆä½œç”¨çš®å±‚â€ã€â€œå–·æ°”å¼æ¨è¿›å›Šâ€ï¼‰ã€‚

### 4. ğŸ“Š ç”Ÿæ€ä½åˆ†æä¸æ•°æ®å¯è§†åŒ–
- **å…¨çƒè¶‹åŠ¿ä»ªè¡¨ç›˜ (Global Trends)**ï¼šç›´è§‚å±•ç¤ºæ°”æ¸©ã€æµ·å¹³é¢ã€ç”Ÿç‰©é‡ä¸ç‰©ç§å¤šæ ·æ€§çš„å†å²èµ°åŠ¿ï¼ˆVictoria 3 é£æ ¼ï¼‰ã€‚
- **ç‰©ç§æ€»è´¦ (Species Ledger)**ï¼šç±»ä¼¼è´¢åŠ¡æŠ¥è¡¨çš„ç‰©ç§æ•°æ®ç®¡ç†è§†å›¾ã€‚
- **å‘é‡åŒ–å¯¹æ¯”**ï¼šä½¿ç”¨ Embedding æŠ€æœ¯è®¡ç®—ç‰©ç§é—´çš„ç”Ÿæ€ä½é‡å åº¦ã€‚
- **ç«äº‰å¯è§†åŒ–**ï¼šç›´è§‚å±•ç¤ºä¸åŒç‰©ç§åœ¨ä½“å‹ã€ä»£è°¢ã€ç¯å¢ƒé€‚åº”æ€§ä¸Šçš„ç«äº‰å…³ç³»ã€‚

### 5. ğŸ”“ è¡¨è§‚é—ä¼ ä¸ä¼‘çœ åŸºå› 
- **å‹åŠ›æ¿€æ´»**ï¼šç‰©ç§ä½“å†…æºå¸¦â€œä¼‘çœ åŸºå› åº“â€ã€‚å½“é¢ä¸´ç­ç»çº§å‹åŠ›ï¼ˆå¦‚çªå‘å†°æœŸï¼‰æ—¶ï¼Œç‰¹å®šçš„æ€§çŠ¶ï¼ˆå¦‚åšçš®æ¯›ï¼‰ä¼šè¢«ç¬é—´æ¿€æ´»ã€‚
- **ééšæœºæ¼”åŒ–**ï¼šæ¨¡æ‹Ÿç”Ÿç‰©å¯¹ç¯å¢ƒçš„ç´§æ€¥ç”Ÿç†ååº”ï¼Œè¡¥å……äº†å¸¸è§„è¾¾å°”æ–‡æ¼”åŒ–é€Ÿåº¦è¿‡æ…¢çš„é—®é¢˜ã€‚

## â™»ï¸ 2025 æ›´æ–°é‡ç‚¹
- **è¡ŒåŠ¨é˜Ÿåˆ— & å‹åŠ›ç¼–æ’**ï¼šé€šè¿‡ `/queue*` API é¢„æ’æœ€å¤š 20 ä¸ªå‹åŠ›æ‰¹æ¬¡ï¼Œå‰ç«¯å³å¯å±•ç¤º `queue_preview`ï¼Œå¹¶åœ¨ `/turns/run` ç©ºå‹è°ƒç”¨æ—¶è‡ªåŠ¨æ¶ˆè€—ã€‚
- **å¤šæä¾›å•† AI è·¯ç”±**ï¼š`UIConfig` æ”¯æŒè‡ªå®šä¹‰ Providerã€å¹¶å‘ä¸Šé™ä¸èƒ½åŠ›çº§è·¯ç”±ï¼›`SettingsDrawer` å¯ç›´æ¥å†™å…¥ `data/settings.json` å¹¶çƒ­æ›´æ–° ModelRouterã€‚
- **åœ°å›¾ç‰©ç§å åŠ **ï¼š`/map` å…è®¸æºå¸¦ `species_code` ä¸ `limit_habitats`ï¼ŒMapPanel å¯ä»¥ä¸ºä»»ä½•ç‰©ç§ç”Ÿæˆå®æ—¶æ –æ¯åœ°çƒ­åŠ›å±‚ã€‚
- **è°±ç³»ä¸æ –æ¯åœ°å¿«ç…§**ï¼š`/lineage`ã€`map_manager.snapshot_habitats` ä¸å¯¼å‡ºç®¡çº¿æ•´åˆï¼Œåˆå§‹å­˜æ¡£ä¼šç”Ÿæˆç¬¬ 0 å›åˆæŠ¥å‘Šå’Œäººå£å¿«ç…§ï¼Œæ–¹ä¾¿å¯è§†åŒ–å†å²ã€‚

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

æœ¬é¡¹ç›®é‡‡ç”¨ Monorepo ç»“æ„ï¼ŒåŒ…å«åç«¯ (FastAPI) å’Œå‰ç«¯ (React)ã€‚

### ç¯å¢ƒè¦æ±‚
- Python 3.10+
- Node.js 18+
- OpenAI API Key (æˆ–å…¼å®¹çš„ LLM æœåŠ¡)

### 1. å¯åŠ¨åç«¯
åç«¯è´Ÿè´£æ ¸å¿ƒæ¨¡æ‹Ÿè®¡ç®—ä¸æ•°æ®å­˜å‚¨ã€‚

```bash
# 1. è¿›å…¥åç«¯ç›®å½•
cd backend

# 2. åˆ›å»ºå¹¶æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
  python -m venv .venv
# Windows (PowerShell):
.\.venv\Scripts\activate
# Linux/macOS:
source .venv/bin/activate

# 3. å®‰è£…ä¾èµ–
pip install -e ".[dev]"

# 4. é…ç½®ç¯å¢ƒå˜é‡
# å¤åˆ¶ç¤ºä¾‹é…ç½®ï¼ˆå¦‚æœå­˜åœ¨ï¼‰æˆ–ç›´æ¥åˆ›å»º .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œå¡«å…¥ä½ çš„ AI_API_KEY å’Œ AI_BASE_URL

# 5. å¯åŠ¨æœåŠ¡
uvicorn app.main:app --reload --port 8000
```
*é¦–æ¬¡å¯åŠ¨ä¼šè‡ªåŠ¨åˆå§‹åŒ– `data/db/egame.db` å¹¶ç”Ÿæˆåˆå§‹ç‰©ç§ã€‚*

### 2. å¯åŠ¨å‰ç«¯
å‰ç«¯æä¾›å¯è§†åŒ–çš„ä¸Šå¸è§†è§’ HUDã€‚

```bash
# æ–°å¼€ä¸€ä¸ªç»ˆç«¯çª—å£ï¼Œè¿›å…¥å‰ç«¯ç›®å½•
cd frontend

# å®‰è£…ä¾èµ–å¹¶å¯åŠ¨
npm install
npm run dev
```
è®¿é—® `http://localhost:5173` å¼€å§‹æ¼”åŒ–ä¹‹æ—…ã€‚

### 3. è¿è¡Œæµ‹è¯•ä¸è°ƒè¯•
ç¡®ä¿æ ¸å¿ƒé€»è¾‘çš„ç¨³å®šæ€§ã€‚

```bash
# è¿è¡Œæ¨¡æ‹Ÿé›†æˆæµ‹è¯• (End-to-End Scenario)
python tests/api_simulation_test/run_test.py
```

æ­¤å¤–ï¼Œä½ å¯ä»¥åœ¨å‰ç«¯ç•Œé¢çš„ **"è®¾ç½® -> å¼€å‘è€…å·¥å…·"** ä¸­ç›´æ¥è¿è¡Œç³»ç»Ÿå¥åº·æ£€æŸ¥æˆ–é‡ç½®ä¸–ç•Œã€‚

## âš™ï¸ AI æœåŠ¡ä¸ UI é…ç½®
- **é…ç½®æ–‡ä»¶**ï¼šé»˜è®¤ä¿å­˜åœ¨ `data/settings.json`ï¼ˆ`UI_CONFIG_PATH` å¯è¦†ç›–ï¼‰ã€‚é€šè¿‡ `/api/config/ui` è¯»å–/å†™å…¥ï¼Œç«‹å³ç”Ÿæ•ˆã€‚
- **å¤š Provider æ¨¡å¼**ï¼š`providers` å­—å…¸ç»´æŠ¤ OpenAI/DeepSeek/è‡ªå»ºä»£ç†ç­‰ï¼Œ`capability_routes` å°† `turn_report`ã€`speciation` ç­‰èƒ½åŠ›æ˜ å°„åˆ°ä¸åŒæ¨¡å‹ï¼Œ`ai_concurrency_limit` æ§åˆ¶ ModelRouter ä¿¡å·é‡ã€‚
- **Embedding**ï¼šåœ¨ `UIConfig` ä¸­æŒ‡å®š `embedding_provider_id` ä¸ `embedding_model`ï¼Œæˆ–ä½¿ç”¨ legacy å­—æ®µ `embedding_base_url`/`embedding_api_key`ã€‚`/api/niche/compare` éœ€è¦çœŸå®å‘é‡æ”¯æŒï¼Œå¦åˆ™ä¼šè¿”å› 503ã€‚
- **è¿é€šæ€§æµ‹è¯•**ï¼š`POST /api/config/test-api` æ”¯æŒ `type=chat|embedding`ï¼Œç”¨äº Settings Drawer æ£€æŸ¥ç¬¬ä¸‰æ–¹ API å¯ç”¨æ€§ã€‚

## ğŸ”§ è¿ç»´ä¸è„šæœ¬
- **Admin API**ï¼š`/api/admin/health`ã€`/api/admin/reset` åˆ†åˆ«è´Ÿè´£å¥åº·æ£€æŸ¥ä¸ä¸–ç•Œé‡ç½®ã€‚ç”Ÿäº§ç¯å¢ƒå»ºè®®åŠ é‰´æƒã€‚
- **å®ç”¨è„šæœ¬**ï¼š
  - `scripts/health_check.py`ï¼šæœ¬åœ° CLI ç‰ˆå¥åº·æ£€æŸ¥ã€‚
  - `scripts/reset_world.py`ï¼šæ‰¹é‡æ¸…ç†æ•°æ®åº“/å­˜æ¡£/å¯¼å‡ºã€‚
- **æ•°æ®ç›®å½•**ï¼šæ‰€æœ‰å¯¼å‡º/å­˜æ¡£/æ—¥å¿—ä½äº `data/`ï¼›è¯·ç¡®ä¿åœ¨éƒ¨ç½²å‰æŒä¹…åŒ–è¿™äº›è·¯å¾„ã€‚

---

## ğŸ“‚ é¡¹ç›®ç»“æ„

```text
Clade/
â”œâ”€â”€ backend/            # æ ¸å¿ƒæ¼”åŒ–å¼•æ“ (FastAPI + SQLModel)
â”‚   â”œâ”€â”€ app/simulation/ # æ¨¡æ‹Ÿå¾ªç¯ä¸»é€»è¾‘
â”‚   â”œâ”€â”€ app/services/   # è§„åˆ™æœåŠ¡ (æ­»äº¡ã€ç¹æ®–ã€åœ°å½¢ã€åˆ†çº§)
â”‚   â””â”€â”€ app/ai/         # AI æ¨¡å‹è·¯ç”±ä¸ Prompt
â”œâ”€â”€ frontend/           # ç­–ç•¥ HUD (React + Vite + D3.js + Recharts)
â”œâ”€â”€ scripts/            # è¿ç»´ä¸æµ‹è¯•è„šæœ¬
â”œâ”€â”€ data/               # [è‡ªåŠ¨ç”Ÿæˆ] å­˜æ¡£ã€æ•°æ®åº“ã€æ—¥å¿—ã€å¯¼å‡ºæ–‡ä»¶
â””â”€â”€ docs/               # å¼€å‘æ–‡æ¡£
```

## ğŸ“– æ–‡æ¡£ç´¢å¼•

- **[å¼€å‘æ–‡æ¡£ (DEV_DOC.md)](DEV_DOC.md)**ï¼šæ·±å…¥äº†è§£æ··åˆæ¶æ„çš„å®ç°åŸç†ã€æ ¸å¿ƒç®—æ³•ä¸æ•°æ®æµã€‚
- **[API æŒ‡å— (API_GUIDE.md)](API_GUIDE.md)**ï¼šæœ€æ–°æ¥å£æ¸…å•ã€æ•°æ®æ¨¡å‹é€ŸæŸ¥ã€‚
- **[åç«¯æ¨¡å—è“å›¾](docs/api-guides/README.md)**ï¼šç³»ç»Ÿåˆ†å±‚ã€æœåŠ¡ç¼–æ’ä¸æ•°æ®æµå…¨æ™¯ã€‚
- **æ¨¡å—å‚è€ƒ**ï¼ˆ`docs/api-guides/modules/*`ï¼‰ï¼š
  - [Simulation](docs/api-guides/modules/simulation/README.md)ï¼šå›åˆæ‰§è¡Œã€å‹åŠ›ã€è¡ŒåŠ¨é˜Ÿåˆ—ã€‚
  - [Species](docs/api-guides/modules/species/README.md)ï¼šè°±ç³»ã€åˆ†åŒ–ã€æ‚äº¤ã€‚
  - [Environment](docs/api-guides/modules/environment/README.md)ï¼šåœ°å›¾ã€åœ°å½¢ã€æ°”å€™ã€‚
  - [Analytics & AI](docs/api-guides/modules/analytics-ai/README.md)ï¼šEmbeddingã€AI è·¯ç”±ä¸ç”Ÿæ€ä½åˆ†æã€‚
  - [Saves & Ops](docs/api-guides/modules/saves-ops/README.md)ï¼šå­˜æ¡£ã€å¯¼å‡ºã€Admin æ“ä½œã€‚
  - [Config & UI](docs/api-guides/modules/config-ui/README.md)ï¼šUIConfig å­—æ®µã€Settings Drawerã€‚
  - [Frontend Integration](docs/api-guides/modules/frontend-integration/README.md)ï¼šå‰ç«¯æœåŠ¡å±‚å°è£…ä¸é”™è¯¯å¤„ç†ã€‚

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Pull Requestï¼æ— è®ºæ˜¯è°ƒæ•´ç”Ÿæ€å‚æ•°ï¼ˆè®©æ¨¡æ‹Ÿæ›´çœŸå®ï¼‰ï¼Œè¿˜æ˜¯ä¼˜åŒ– AI Promptï¼ˆè®©å™äº‹æ›´ç²¾å½©ï¼‰ï¼Œæˆ‘ä»¬éƒ½éå¸¸æœŸå¾…ã€‚

## ğŸ“„ è®¸å¯

æœ¬é¡¹ç›®é‡‡ç”¨MITå¼€æºåè®®ï¼Œå…·ä½“è¯·æŸ¥çœ‹LICENCEæ–‡ä»¶
