"""æ¤ç‰©æ¼”åŒ–ä¸“ç”¨Promptæ¨¡æ¿

ã€è®¾è®¡åŸåˆ™ã€‘
- ä¸åŠ¨ç‰©Promptåˆ†ç¦»ï¼Œä¸“æ³¨äºæ¤ç‰©æ¼”åŒ–é€»è¾‘
- å¼ºè°ƒé˜¶æ®µé€’è¿›å’Œé‡Œç¨‹ç¢‘ç³»ç»Ÿ
- é›†æˆEmbeddingé¢„æµ‹ä¸Šä¸‹æ–‡
- æ¤ç‰©ç«äº‰å’Œé£Ÿè‰å‹åŠ›é›†æˆ
"""

PLANT_PROMPTS = {
    # ==================== æ¤ç‰©å‹åŠ›å“åº”Prompt ====================
    "plant_pressure_response": """ä½ æ˜¯å¤æ¤ç‰©å­¦å®¶ï¼Œåˆ†ææ¤ç‰©å¯¹ç¯å¢ƒå‹åŠ›çš„é€‚åº”æ€§æ¼”åŒ–ã€‚

**é‡è¦ï¼šåªè¿”å›çº¯JSONï¼Œä¸è¦markdownã€‚**

=== å½“å‰ç¯å¢ƒå‹åŠ› ===
{pressure_context}

=== æ¤ç‰©æ¡£æ¡ˆ ===
ã€åŸºæœ¬ä¿¡æ¯ã€‘
å­¦åï¼š{latin_name} ({common_name})
æ –æ¯åœ°ï¼š{habitat_type}
ç”Ÿå‘½å½¢å¼é˜¶æ®µï¼š{life_form_stage} ({life_form_name})
ç”Ÿé•¿å½¢å¼ï¼š{growth_form}

ã€å½“å‰ç‰¹è´¨ã€‘ï¼ˆ1-15åˆ†åˆ¶ï¼‰
{plant_traits_summary}

ã€å™¨å®˜ç³»ç»Ÿã€‘
{plant_organs_summary}

=== ã€Embeddingé¢„æµ‹å‚è€ƒã€‘===
{embedding_prediction}

=== ã€æ¤ç‰©ç«äº‰çŠ¶æ€ã€‘===
{competition_context}

=== ã€é£Ÿè‰åŠ¨ç‰©å¨èƒã€‘===
{herbivory_context}

=== é‡Œç¨‹ç¢‘è¿›åº¦ ===
{milestone_progress}

=== æ¤ç‰©æ¼”åŒ–è§„åˆ™ï¼ˆ50ä¸‡å¹´æ—¶é—´å°ºåº¦ï¼‰===
1. **é˜¶æ®µé€’è¿›**ï¼šæ¼”åŒ–éœ€é€é˜¶æ®µè¿›è¡Œï¼Œä¸èƒ½è·³çº§
   - åŸæ ¸(0) â†’ å•ç»†èƒ(1) â†’ ç¾¤ä½“(2) â†’ è‹”è—“(3) â†’ è•¨ç±»(4) â†’ è£¸å­(5) â†’ è¢«å­(6)
   
2. **ç™»é™†å‰ç½®**ï¼šé˜¶æ®µ2å¯å…ˆå‘å±•æ²¿å²¸é€‚åº”ï¼ˆä¿æ°´èƒ½åŠ›3.0+ï¼‰ï¼Œå†å®Œå…¨ç™»é™†
   
3. **ç™»é™†æ¡ä»¶**ï¼šä»æ°´ç”Ÿåˆ°é™†ç”Ÿéœ€æ»¡è¶³ï¼š
   - ä¿æ°´èƒ½åŠ› >= 5.0 ä¸” è€æ—±æ€§ >= 4.0
   - å…·æœ‰"è§’è´¨å±‚"æˆ–æ›´é«˜çº§ä¿æŠ¤ç»“æ„
   - é˜¶æ®µ >= 3 (è‹”è—“çº§)
   
4. **æˆä¸ºæ ‘æœ¨æ¡ä»¶**ï¼š
   - æœ¨è´¨åŒ–ç¨‹åº¦ >= 7.0
   - å…·æœ‰"æœ¨è´¨èŒ"æˆ–æ›´é«˜çº§æ”¯æ’‘ç»“æ„
   - é˜¶æ®µ >= 5 (è£¸å­æ¤ç‰©)

5. **èƒ½é‡å®ˆæ’**ï¼šç‰¹è´¨å˜åŒ–æ€»å’Œåœ¨ [-2.0, +3.0]

6. **ä»£ä»·æœºåˆ¶**ï¼š
   - å¢å¼ºå…‰åˆæ•ˆç‡ â†’ å¯èƒ½é™ä½è€æ—±æ€§ï¼ˆéœ€è¦æ›´å¤šæ°´ï¼‰
   - å¢åŠ æœ¨è´¨åŒ– â†’ é™ä½ç¹æ®–é€Ÿåº¦
   - å‘å±•æ ¹ç³» â†’ é™ä½æ•£å¸ƒèƒ½åŠ›ï¼ˆå›ºç€ï¼‰

7. **é˜²å¾¡å“åº”**ï¼šå¦‚æœé£Ÿè‰å‹åŠ› > 30%ï¼Œä¼˜å…ˆè€ƒè™‘å‘å±•é˜²å¾¡ç‰¹è´¨/å™¨å®˜

=== è¾“å‡ºæ ¼å¼ ===
{{
    "analysis": "50-80å­—æ¼”åŒ–åˆ†æï¼Œè§£é‡Šé€‚åº”æ€§å˜åŒ–çš„åŸå› ",
    "recommended_changes": {{
        "ç‰¹è´¨å": "+/-æ•°å€¼"
    }},
    "organ_changes": [
        {{
            "category": "å™¨å®˜ç±»åˆ«",
            "change_type": "enhance/degrade/new",
            "new_organ": "å™¨å®˜åï¼ˆå¦‚newç±»å‹ï¼‰",
            "parameter": "å‚æ•°å",
            "delta": æ•°å€¼å˜åŒ–
        }}
    ],
    "priority": "high/medium/low",
    "defense_response": "å¦‚æœ‰é£Ÿè‰å‹åŠ›ï¼Œæè¿°é˜²å¾¡ç­–ç•¥",
    "milestone_approach": "å¦‚æ¥è¿‘é‡Œç¨‹ç¢‘ï¼Œæè¿°å¦‚ä½•æ¨è¿›",
    "rationale": "30å­—å†…çš„æ¼”åŒ–æœºåˆ¶è§£é‡Š"
}}

åªè¿”å›JSONå¯¹è±¡ã€‚
""",

    # ==================== æ¤ç‰©åˆ†åŒ–Promptï¼ˆæ··åˆæ¨¡å¼ï¼‰====================
    "plant_speciation": """ä½ æ˜¯å¤æ¤ç‰©å­¦ä¸“å®¶ï¼Œä¸ºåˆ†åŒ–çš„æ¤ç‰©ç‰©ç§è®¾è®¡æ–°ç‰¹å¾ã€‚

**é‡è¦ï¼šåªè¿”å›çº¯JSONï¼Œä¸è¦markdownã€‚**

=== äº²æœ¬æ¤ç‰© ===
ã€åŸºæœ¬ä¿¡æ¯ã€‘
å­¦åï¼š{parent_latin_name} ({parent_common_name})
è°±ç³»ä»£ç ï¼š{parent_lineage_code}
æ –æ¯åœ°ï¼š{parent_habitat_type}
å½“å‰é˜¶æ®µï¼š{parent_life_form_stage} ({parent_life_form_name})
ç”Ÿé•¿å½¢å¼ï¼š{parent_growth_form}

ã€å½“å‰ç‰¹è´¨ã€‘
{parent_traits_summary}

ã€å™¨å®˜ç³»ç»Ÿã€‘
{parent_organs_summary}

=== åˆ†åŒ–è§¦å‘æ¡ä»¶ ===
{speciation_trigger}

=== å½“å‰ç¯å¢ƒå‹åŠ› ===
{pressure_context}

=== ã€Embeddingé¢„æµ‹å‚è€ƒã€‘===
{embedding_context}

=== æ¼”åŒ–é‡Œç¨‹ç¢‘æç¤º ===
{milestone_hints}

=== ğŸŒ± åˆ›æ„å™¨å®˜ç³»ç»Ÿï¼ˆåœ¨æ¡†æ¶å†…è‡ªç”±å‘æŒ¥ï¼ï¼‰===

ã€æ ¸å¿ƒç†å¿µã€‘
- å™¨å®˜**ç±»åˆ«**æ˜¯å›ºå®šçš„ï¼ˆ8ä¸ªå¤§ç±»ï¼‰
- å™¨å®˜**åç§°**å¯ä»¥è‡ªç”±åˆ›é€ ï¼ä¸å¿…æ‹˜æ³¥äºå‚è€ƒåˆ—è¡¨
- ä½ å¯ä»¥åˆ›é€ ç‹¬ç‰¹çš„é€‚åº”æ€§ç»“æ„ï¼Œåªè¦ç¬¦åˆé˜¶æ®µé™åˆ¶å’Œå‚æ•°èŒƒå›´

ã€å¯ç”¨å™¨å®˜ç±»åˆ«ã€‘
{organ_categories_info}

ã€é‡Œç¨‹ç¢‘å¿…é¡»å™¨å®˜ã€‘ï¼ˆè¿™äº›å™¨å®˜åç§°ä¸èƒ½æ›¿æ¢ï¼‰
- ç™»é™†(é˜¶æ®µ2â†’3): å¿…é¡»è·å¾—"è§’è´¨å±‚"å’Œ"å‡æ ¹"
- çœŸæ ¹(é˜¶æ®µ3â†’4): å¿…é¡»è·å¾—"åŸå§‹æ ¹"å’Œ"ç»´ç®¡æŸ"
- ç§å­(é˜¶æ®µ4â†’5): å¿…é¡»è·å¾—"èƒšç "
- å¼€èŠ±(é˜¶æ®µ5â†’6): å¿…é¡»è·å¾—"èŠ±"å’Œ"æœå®"
- æˆä¸ºæ ‘æœ¨: å¿…é¡»è·å¾—"ä¹”æœ¨å¹²"

ã€è‡ªç”±åˆ›æ„ç¤ºä¾‹ã€‘
- ğŸŒ¿ "å‡éœ²æ¯›åˆº": ä¿æŠ¤ç±»å™¨å®˜ï¼Œåœ¨å¤œé—´ä»ç©ºæ°”ä¸­æ”¶é›†æ°´åˆ† (drought_resist: 1.2)
- ğŸƒ "ç¡…åŒ–è¡¨çš®": é˜²å¾¡ç±»å™¨å®˜ï¼ŒäºŒæ°§åŒ–ç¡…æ²‰ç§¯é˜²æ­¢è¢«å•ƒé£Ÿ (defense_power: 0.8)
- ğŸŒ± "æ°”å›Šç»„ç»‡": å‚¨å­˜ç±»å™¨å®˜ï¼Œä½å¯†åº¦ç»„ç»‡ä½¿ç§å­é£˜æµ® (capacity: 0.6)
- ğŸŒ³ "æ¿çŠ¶æ ¹": æ ¹ç³»å™¨å®˜ï¼Œçƒ­å¸¦é›¨æ—æ ‘æœ¨çš„ç¨³å®šç»“æ„ (depth_cm: 50, absorption: 1.2)

=== âš ï¸ ç¡¬æ€§çº¦æŸï¼ˆå¿…é¡»éµå®ˆï¼‰===

ã€1. é˜¶æ®µçº¦æŸã€‘
å½“å‰é˜¶æ®µ: {parent_life_form_stage}
- åªèƒ½ä¿æŒå½“å‰é˜¶æ®µæˆ–å‡çº§åˆ° {parent_life_form_stage}+1
- âŒ è·³çº§å‡çº§

ã€2. ç™»é™†æ¡ä»¶ã€‘ï¼ˆé˜¶æ®µ2â†’3ï¼‰
- ä¿æ°´èƒ½åŠ› >= 5.0 ä¸” è€æ—±æ€§ >= 4.0
- å¿…é¡»å…·æœ‰"è§’è´¨å±‚"

ã€3. æˆä¸ºæ ‘æœ¨æ¡ä»¶ã€‘
- æœ¨è´¨åŒ–ç¨‹åº¦ >= 7.0 ä¸” é˜¶æ®µ >= 5

ã€4. èƒ½é‡å®ˆæ’ã€‘
- ç‰¹è´¨å˜åŒ–æ€»å’Œåœ¨ [-2.0, +3.0]

ã€5. æƒè¡¡ä»£ä»·ã€‘
- å¢å¼ºå¿…æœ‰ä»£ä»·ï¼Œæœ‰å¢å¿…æœ‰å‡

=== é˜¶æ®µå‡çº§æ¡ä»¶å‚è€ƒ ===
- é˜¶æ®µ1: å¤šç»†èƒç¨‹åº¦ >= 1.5
- é˜¶æ®µ2: å¤šç»†èƒç¨‹åº¦ >= 3.0
- é˜¶æ®µ3: ä¿æ°´èƒ½åŠ› >= 5.0, è€æ—±æ€§ >= 4.0
- é˜¶æ®µ4: æ ¹ç³»å‘è¾¾åº¦ >= 5.0
- é˜¶æ®µ5: ç§å­åŒ–ç¨‹åº¦ >= 5.0
- é˜¶æ®µ6: ç§å­åŒ–ç¨‹åº¦ >= 8.0, æ•£å¸ƒèƒ½åŠ› >= 7.0

=== è¾“å‡ºæ ¼å¼ ===
{{
    "latin_name": "æ–°å­¦å",
    "common_name": "æ–°ä¿—å",
    "description": "100-120å­—æè¿°ï¼Œå¼ºè°ƒä½ çš„åˆ›æ„ç»“æ„",
    "life_form_stage": {parent_life_form_stage}æˆ–{parent_life_form_stage}+1,
    "growth_form": "aquatic/moss/herb/shrub/tree",
    "trait_changes": {{
        "å¢å¼ºç‰¹è´¨": +æ•°å€¼,
        "ä»£ä»·ç‰¹è´¨": -æ•°å€¼
    }},
    "new_organs": ["å™¨å®˜åç§°ï¼ˆå¯ä»¥æ˜¯åˆ›æ„åç§°ï¼‰"],
    "organ_changes": [
        {{
            "category": "ç±»åˆ«(8ç§ä¹‹ä¸€)",
            "change_type": "new/enhance/degrade",
            "organ_name": "å™¨å®˜åï¼ˆé‡Œç¨‹ç¢‘å™¨å®˜ç”¨å›ºå®šåï¼Œå…¶ä»–å¯è‡ªç”±å‘½åï¼‰",
            "parameters": {{"å‚æ•°1": å€¼, "å‚æ•°2": å€¼}}
        }}
    ],
    "key_innovations": ["ä½ çš„åˆ›æ„æ¼”åŒ–ç‚¹ï¼"],
    "milestone_triggered": "é‡Œç¨‹ç¢‘IDæˆ–null",
    "habitat_type": "marine/freshwater/coastal/terrestrial",
    "trophic_level": 1.0-1.5,
    "rationale": "30å­—å†…æ¼”åŒ–æœºåˆ¶"
}}

=== åˆ›æ„ç¤ºä¾‹1ï¼ˆé«˜å±±ç¯å¢ƒçš„è‹”è—“é€‚åº”ï¼‰===
äº²æœ¬: é˜¶æ®µ3è‹”è—“ï¼Œé¢ä¸´ç´«å¤–çº¿å‹åŠ›å’Œå¹²æ—±
{{
    "latin_name": "Bryophytella alpina",
    "common_name": "é«˜å±±é“¶è‹”",
    "description": "é«˜æµ·æ‹”é€‚åº”çš„è‹”è—“å…ˆé©±ã€‚å‘å±•å‡ºé“¶è‰²åå…‰è¡¨çš®åå°„è¿‡é‡ç´«å¤–çº¿ï¼Œæ·±å±‚è‰²ç´ ä½“æ²‰é™åˆ°ç»†èƒåº•éƒ¨é¿å…è¾å°„æŸä¼¤ã€‚å‡æ ¹ç‰¹åŒ–ä¸ºé”šå®šç»“æ„ï¼Œç´§æŠ“å²©ç¼æŠµå¾¡å¼ºé£ã€‚å¤œé—´ä»é›¾æ°”ä¸­æ”¶é›†æ°´åˆ†çš„å‡éœ²æ¯›åˆºæ˜¯å…¶ç‹¬ç‰¹åˆ›æ–°ã€‚",
    "life_form_stage": 3,
    "growth_form": "moss",
    "trait_changes": {{"è€æ—±æ€§": "+1.5", "å…‰åˆæ•ˆç‡": "-0.5", "ç¹æ®–é€Ÿåº¦": "-0.3", "ä¿æ°´èƒ½åŠ›": "+0.8"}},
    "new_organs": ["é“¶è‰²åå…‰å±‚", "å‡éœ²æ¯›åˆº"],
    "organ_changes": [
        {{"category": "protection", "change_type": "new", "organ_name": "é“¶è‰²åå…‰å±‚", "parameters": {{"uv_resist": 2.0, "drought_resist": 0.5}}}},
        {{"category": "protection", "change_type": "new", "organ_name": "å‡éœ²æ¯›åˆº", "parameters": {{"drought_resist": 1.2}}}}
    ],
    "key_innovations": ["åå°„ç´«å¤–çº¿çš„é“¶è‰²è¡¨çš®", "ä»é›¾æ°”æ”¶é›†æ°´åˆ†çš„æ¯›åˆºç»“æ„"],
    "milestone_triggered": null,
    "habitat_type": "terrestrial",
    "trophic_level": 1.0,
    "rationale": "é«˜æµ·æ‹”ç´«å¤–çº¿å’Œå¹²æ—±å‹åŠ›é©±åŠ¨ç‹¬ç‰¹ä¿æŠ¤ç»“æ„æ¼”åŒ–"
}}

=== åˆ›æ„ç¤ºä¾‹2ï¼ˆæ½®é—´å¸¦è¿‡æ¸¡ - å‡†å¤‡ç™»é™†ï¼‰===
äº²æœ¬: é˜¶æ®µ2ç¾¤ä½“è—»ç±»ï¼Œå¤„äºæ½®é—´å¸¦ç¯å¢ƒï¼Œä¿æ°´èƒ½åŠ›=4.8ï¼Œè€æ—±æ€§=3.8
{{
    "latin_name": "Thalassophyta transitoria",
    "common_name": "è¿‡æ¸¡ä¸è—»",
    "description": "æ½®é—´å¸¦çš„å…ˆé©±ç‰©ç§ï¼Œæ­£åœ¨ä¸ºç™»é™†åšå‡†å¤‡ã€‚å‘å±•å‡ºåŸå§‹è§’è´¨å±‚å‡ç¼“æ°´åˆ†æ•£å¤±ï¼Œç®€å•å‡æ ¹å¼€å§‹å›ºç€å²©çŸ³ã€‚åœ¨æ½®æ±å‘¨æœŸä¸­èƒ½çŸ­æš‚æš´éœ²äºç©ºæ°”ã€‚è¿™æ˜¯ä»æ°´ç”Ÿåˆ°é™†ç”Ÿçš„å…³é”®è¿‡æ¸¡å½¢æ€ã€‚",
    "life_form_stage": 3,
    "growth_form": "moss",
    "trait_changes": {{"ä¿æ°´èƒ½åŠ›": "+1.2", "è€æ—±æ€§": "+0.8", "å…‰åˆæ•ˆç‡": "-0.5", "ç¹æ®–é€Ÿåº¦": "-0.5"}},
    "new_organs": ["è§’è´¨å±‚", "å‡æ ¹"],
    "organ_changes": [
        {{"category": "protection", "change_type": "new", "organ_name": "è§’è´¨å±‚", "parameters": {{"uv_resist": 1.0, "drought_resist": 0.8}}}},
        {{"category": "root_system", "change_type": "new", "organ_name": "å‡æ ¹", "parameters": {{"depth_cm": 0.5, "absorption": 0.3}}}}
    ],
    "key_innovations": ["é¦–æ¬¡ç™»é™†é™†åœ°", "åŸå§‹ä¿æ°´ç»“æ„"],
    "milestone_triggered": "first_land_plant",
    "habitat_type": "coastal",
    "trophic_level": 1.0,
    "rationale": "æ½®é—´å¸¦å¹²æ¹¿äº¤æ›¿é©±åŠ¨ä¿æ°´å’Œå›ºç€ç»“æ„æ¼”åŒ–ï¼Œè§¦å‘ç™»é™†é‡Œç¨‹ç¢‘"
}}

=== åˆ›æ„ç¤ºä¾‹3ï¼ˆç§å­é©å‘½ - é˜¶æ®µ4â†’5ï¼‰===
äº²æœ¬: é˜¶æ®µ4è•¨ç±»ï¼Œç§å­åŒ–ç¨‹åº¦=4.8ï¼Œé¢ä¸´å¹²æ—±å­£èŠ‚
{{
    "latin_name": "Pteridosperma primordialis",
    "common_name": "åŸå§‹ç§å­è•¨",
    "description": "å¹²æ—±å‹åŠ›ä¿ƒä½¿å­¢å­å›Šå†…éƒ¨å½¢æˆèƒšç ç»“æ„ï¼Œå°†å­¢å­ä¿æŠ¤åœ¨åšç¡¬å¤–å£³å†…ã€‚è¿™æ˜¯ç§å­çš„é›å½¢ï¼Œä½¿ç¹æ®–ä¸å†å®Œå…¨ä¾èµ–æ°´ç¯å¢ƒã€‚ç¹æ®–æ•ˆç‡æš‚æ—¶é™ä½ï¼Œä½†åä»£å­˜æ´»ç‡å¤§å¹…æå‡ã€‚",
    "life_form_stage": 5,
    "growth_form": "shrub",
    "trait_changes": {{"ç§å­åŒ–ç¨‹åº¦": "+1.5", "è€æ—±æ€§": "+0.8", "ç¹æ®–é€Ÿåº¦": "-1.0", "æ•£å¸ƒèƒ½åŠ›": "+0.5"}},
    "new_organs": ["èƒšç "],
    "organ_changes": [
        {{"category": "reproductive", "change_type": "new", "organ_name": "èƒšç ", "parameters": {{"dispersal_km": 0.2}}}}
    ],
    "key_innovations": ["ç§å­ç»“æ„é›å½¢", "å¹²æ—±æœŸç¹æ®–èƒ½åŠ›"],
    "milestone_triggered": "first_seed",
    "habitat_type": "terrestrial",
    "trophic_level": 1.0,
    "rationale": "å¹²æ—±å­£èŠ‚å‹åŠ›é©±åŠ¨ç§å­ç»“æ„æ¼”åŒ–ï¼Œæ‘†è„±æ°´ä¾èµ–ç¹æ®–"
}}

=== åˆ›æ„ç¤ºä¾‹4ï¼ˆé£Ÿè‰å‹åŠ›ä¸‹çš„é˜²å¾¡æ¼”åŒ–ï¼‰===
äº²æœ¬: é˜¶æ®µ4è•¨ç±»ï¼Œé¢ä¸´é£Ÿè‰åŠ¨ç‰©é«˜å‹åŠ›ï¼ˆ50%ï¼‰
{{
    "latin_name": "Pteridophyta toxica",
    "common_name": "æ¯’è•¨",
    "description": "é¢å¯¹æ—¥ç›Šå¢é•¿çš„é£Ÿè‰åŠ¨ç‰©å‹åŠ›ï¼Œè¿™ç§è•¨ç±»æ¼”åŒ–å‡ºåŒ–å­¦é˜²å¾¡ç³»ç»Ÿã€‚å¶ç‰‡ä¸­ç§¯ç´¯è‹¦å‘³ç”Ÿç‰©ç¢±ï¼Œä½¿é£Ÿè‰åŠ¨ç‰©äº§ç”ŸåŒæ¶ååº”ã€‚æ–°å‘å±•çš„æ¯’è…ºæŒç»­åˆ†æ³Œæ¯’ç´ ï¼Œä½†ä»£ä»·æ˜¯ç”Ÿé•¿é€Ÿåº¦æ”¾ç¼“ã€‚",
    "life_form_stage": 4,
    "growth_form": "herb",
    "trait_changes": {{"åŒ–å­¦é˜²å¾¡": "+2.0", "ç‰©ç†é˜²å¾¡": "+0.5", "ç¹æ®–é€Ÿåº¦": "-0.8", "å…‰åˆæ•ˆç‡": "-0.3"}},
    "new_organs": ["æ¯’è…º"],
    "organ_changes": [
        {{"category": "defense", "change_type": "new", "organ_name": "æ¯’è…º", "parameters": {{"defense_power": 1.0}}}}
    ],
    "key_innovations": ["åŒ–å­¦é˜²å¾¡ç³»ç»Ÿ", "ç”Ÿç‰©ç¢±ç§¯ç´¯"],
    "milestone_triggered": null,
    "habitat_type": "terrestrial",
    "trophic_level": 1.0,
    "rationale": "é£Ÿè‰åŠ¨ç‰©å‹åŠ›é©±åŠ¨åŒ–å­¦é˜²å¾¡æ¼”åŒ–"
}}

å‘æŒ¥åˆ›æ„ï¼Œåˆ›é€ ç‹¬ç‰¹çš„é€‚åº”æ€§ç»“æ„ï¼åªè¿”å›JSONå¯¹è±¡ã€‚
""",

    # ==================== æ¤ç‰©ç‰©ç§ç”ŸæˆPrompt ====================
    "plant_generation": """ä½ æ˜¯æ¤ç‰©å­¦ä¸“å®¶ï¼ŒåŸºäºç”¨æˆ·æè¿°ç”Ÿæˆæ¤ç‰©ç‰©ç§æ•°æ®ã€‚

**é‡è¦ï¼šåªè¿”å›çº¯JSONï¼Œä¸è¦markdownã€‚**

ç”¨æˆ·æè¿°ï¼š{user_prompt}

å½“å‰ç”Ÿæ€ç³»ç»Ÿä¸­çš„ç‰©ç§ï¼š
{existing_species_context}

=== æ¤ç‰©é˜¶æ®µè¯´æ˜ ===
- 0: åŸæ ¸å…‰åˆç”Ÿç‰©ï¼ˆè“è—»ã€å…‰åˆç»†èŒï¼‰
- 1: å•ç»†èƒçœŸæ ¸è—»ç±»ï¼ˆç»¿è—»ã€ç¡…è—»ï¼‰
- 2: ç¾¤ä½“/ä¸çŠ¶è—»ç±»ï¼ˆå›¢è—»ã€æ°´ç»µï¼‰
- 3: è‹”è—“ç±»ï¼ˆè‹”è—“ã€åœ°è¡£ï¼Œé™†ç”Ÿå…ˆé”‹ï¼‰
- 4: è•¨ç±»ï¼ˆæœ‰æ ¹æœ‰ç»´ç®¡æŸï¼Œæ— ç§å­ï¼‰
- 5: è£¸å­æ¤ç‰©ï¼ˆæœ‰ç§å­æ— èŠ±ï¼Œé’ˆå¶æ ‘ï¼‰
- 6: è¢«å­æ¤ç‰©ï¼ˆæœ‰èŠ±æœ‰æœï¼Œå¼€èŠ±æ¤ç‰©ï¼‰

=== ç”Ÿé•¿å½¢å¼çº¦æŸ ===
- aquatic: é˜¶æ®µ0-2å¿…é¡»ä¸ºæ°´ç”Ÿ
- moss: é˜¶æ®µ3ä¸ºè‹”è—“
- herb: é˜¶æ®µ4-6å¯ä¸ºè‰æœ¬
- shrub: é˜¶æ®µ5-6å¯ä¸ºçŒæœ¨
- tree: é˜¶æ®µ5-6å¯ä¸ºä¹”æœ¨ï¼ˆéœ€æœ¨è´¨åŒ–ç¨‹åº¦>=7ï¼‰

=== è¾“å‡ºæ ¼å¼ ===
{{
    "description": "100-120å­—çš„ç”Ÿç‰©å­¦æè¿°ï¼ŒåŒ…å«å½¢æ€ç‰¹å¾ã€ç”Ÿæ€ä½ã€ç”Ÿæ´»å²",
    "life_form_stage": 0-6çš„æ•´æ•°,
    "growth_form": "aquatic/moss/herb/shrub/tree",
    "habitat_type": "marine/freshwater/coastal/terrestrial",
    "diet_type": "autotroph",
    "morphology_stats": {{
        "body_length_cm": ä½“é•¿ï¼ˆå˜ç±³ï¼Œå¾®ç”Ÿç‰©ç”¨å°æ•°å¦‚0.001ï¼‰,
        "body_weight_g": ä½“é‡ï¼ˆå…‹ï¼‰,
        "lifespan_days": å¯¿å‘½ï¼ˆå¤©ï¼‰,
        "generation_time_days": ä¸–ä»£æ—¶é—´ï¼ˆå¤©ï¼‰,
        "metabolic_rate": ä»£è°¢ç‡ï¼ˆ0.1-10.0ï¼‰
    }},
    "abstract_traits": {{
        "è€å¯’æ€§": 0.0-15.0,
        "è€çƒ­æ€§": 0.0-15.0,
        "è€æ—±æ€§": 0.0-15.0,
        "è€ç›æ€§": 0.0-15.0,
        "å…‰ç…§éœ€æ±‚": 0.0-15.0,
        "ç¹æ®–é€Ÿåº¦": 0.0-15.0,
        "å…‰åˆæ•ˆç‡": 0.0-15.0,
        "å›ºç¢³èƒ½åŠ›": 0.0-15.0,
        "æ ¹ç³»å‘è¾¾åº¦": 0.0-15.0,
        "ä¿æ°´èƒ½åŠ›": 0.0-15.0,
        "å…»åˆ†å¸æ”¶": 0.0-15.0,
        "å¤šç»†èƒç¨‹åº¦": 0.0-15.0,
        "æœ¨è´¨åŒ–ç¨‹åº¦": 0.0-15.0,
        "ç§å­åŒ–ç¨‹åº¦": 0.0-15.0,
        "æ•£å¸ƒèƒ½åŠ›": 0.0-15.0,
        "åŒ–å­¦é˜²å¾¡": 0.0-15.0,
        "ç‰©ç†é˜²å¾¡": 0.0-15.0
    }},
    "hidden_traits": {{
        "gene_diversity": 0.0-1.0,
        "environment_sensitivity": 0.0-1.0,
        "evolution_potential": 0.0-1.0,
        "mutation_rate": 0.0-1.0,
        "adaptation_speed": 0.0-1.0
    }},
    "organs": {{
        "photosynthetic": {{
            "type": "å™¨å®˜å",
            "parameters": {{"efficiency": æ•°å€¼}},
            "acquired_turn": 0,
            "is_active": true
        }}
    }},
    "capabilities": ["å…‰åˆä½œç”¨", "è‡ªå…»"]
}}

åªè¿”å›JSONå¯¹è±¡ã€‚
""",

    # ==================== æ¤ç‰©æ‰¹é‡åˆ†åŒ–Prompt ====================
    "plant_speciation_batch": """ä½ æ˜¯å¤æ¤ç‰©å­¦ä¸“å®¶ï¼Œæ‰¹é‡ä¸ºå¤šä¸ªæ¤ç‰©ç‰©ç§è®¾è®¡åˆ†åŒ–åä»£ã€‚

**é‡è¦ï¼šåªè¿”å›çº¯JSONï¼Œä¸è¦markdownã€‚**

=== å…¨å±€ç¯å¢ƒèƒŒæ™¯ ===
ç¯å¢ƒå‹åŠ›å¼ºåº¦ï¼š{average_pressure:.2f}/10
å‹åŠ›æ¥æºï¼š{pressure_summary}
é‡å¤§äº‹ä»¶ï¼š{major_events}

=== å¾…åˆ†åŒ–æ¤ç‰©åˆ—è¡¨ ===
{species_list}

æ¯ä¸ªæ¤ç‰©æ¡ç›®åŒ…å«ï¼š
- åŸºæœ¬ä¿¡æ¯ï¼ˆåç§°ã€é˜¶æ®µã€ç‰¹è´¨ï¼‰
- å™¨å®˜çº¦æŸï¼ˆå½“å‰å™¨å®˜é˜¶æ®µï¼‰
- é‡Œç¨‹ç¢‘å‡†å¤‡åº¦
- ç«äº‰å’Œé£Ÿè‰å‹åŠ›

=== ğŸŒ± æ¤ç‰©æ¼”åŒ–ç¡¬æ€§çº¦æŸ ===

ã€1. é˜¶æ®µå‡çº§æ¡ä»¶ã€‘
- é˜¶æ®µ0â†’1ï¼ˆçœŸæ ¸åŒ–ï¼‰ï¼šå¤šç»†èƒç¨‹åº¦ >= 1.5
- é˜¶æ®µ1â†’2ï¼ˆç¾¤ä½“åŒ–ï¼‰ï¼šå¤šç»†èƒç¨‹åº¦ >= 3.0
- é˜¶æ®µ2â†’3ï¼ˆç™»é™†ï¼‰âš ï¸å…³é”®ï¼šä¿æ°´èƒ½åŠ› >= 5.0 ä¸” è€æ—±æ€§ >= 4.0
- é˜¶æ®µ3â†’4ï¼ˆçœŸæ ¹ï¼‰ï¼šæ ¹ç³»å‘è¾¾åº¦ >= 5.0
- é˜¶æ®µ4â†’5ï¼ˆç§å­ï¼‰ï¼šç§å­åŒ–ç¨‹åº¦ >= 5.0
- é˜¶æ®µ5â†’6ï¼ˆå¼€èŠ±ï¼‰ï¼šç§å­åŒ–ç¨‹åº¦ >= 8.0 ä¸” æ•£å¸ƒèƒ½åŠ› >= 7.0
- æˆä¸ºæ ‘æœ¨ï¼šæœ¨è´¨åŒ–ç¨‹åº¦ >= 7.0 ä¸” é˜¶æ®µ >= 5

ã€2. å±æ€§æƒè¡¡é¢„ç®—ã€‘
- è¯·å‚è€ƒæ¯ä¸ªç‰©ç§æ¡ç›®ä¸­çš„ã€å±æ€§é¢„ç®—ã€‘ï¼ˆåŒ…å«æ—¶ä»£ä¸Šé™ï¼‰
- å¿…é¡»æœ‰å¢æœ‰å‡ï¼

ã€3. é‡Œç¨‹ç¢‘å¿…éœ€å™¨å®˜ã€‘
- ç™»é™†: å¿…é¡»è·å¾—"è§’è´¨å±‚"å’Œ"å‡æ ¹"
- çœŸæ ¹: å¿…é¡»è·å¾—"åŸå§‹æ ¹"å’Œ"ç»´ç®¡æŸ"
- ç§å­: å¿…é¡»è·å¾—"èƒšç "
- å¼€èŠ±: å¿…é¡»è·å¾—"èŠ±"å’Œ"æœå®"
- æˆä¸ºæ ‘æœ¨: å¿…é¡»è·å¾—"ä¹”æœ¨å¹²"

ã€4. å™¨å®˜ç±»åˆ«ã€‘
- photosynthetic: å…‰åˆå™¨å®˜ï¼ˆå¶ç»¿ä½“â†’ç±»å›Šä½“è†œâ†’çœŸå¶â†’é˜”å¶ï¼‰
- root_system: æ ¹ç³»ï¼ˆå‡æ ¹â†’åŸå§‹æ ¹â†’é¡»æ ¹ç³»â†’ç›´æ ¹ç³»ï¼‰
- stem: èŒï¼ˆåŒåŒèŒâ†’è‰æœ¬èŒâ†’æœ¨è´¨èŒâ†’ä¹”æœ¨å¹²ï¼‰
- reproductive: ç¹æ®–ï¼ˆå­¢å­å›Šâ†’èƒšç â†’çƒæœâ†’èŠ±â†’æœå®ï¼‰
- protection: ä¿æŠ¤ï¼ˆç²˜æ¶²å±‚â†’è§’è´¨å±‚â†’èœ¡è´¨è¡¨çš®â†’æ ‘çš®ï¼‰
- vascular: ç»´ç®¡ï¼ˆåŸå§‹ç»´ç®¡æŸâ†’ç»´ç®¡æŸâ†’æ¬¡ç”Ÿæœ¨è´¨éƒ¨ï¼‰
- storage: å‚¨å­˜ï¼ˆå—æ ¹ã€å—èŒç­‰ï¼‰
- defense: é˜²å¾¡ï¼ˆåˆºã€æ¯’è…ºç­‰ï¼‰

ã€5. æƒè¡¡ä»£ä»·ã€‘
- å¢å¼ºå…‰åˆæ•ˆç‡ â†’ é™ä½è€æ—±æ€§
- å¢åŠ æœ¨è´¨åŒ– â†’ é™ä½ç¹æ®–é€Ÿåº¦
- å‘å±•æ ¹ç³» â†’ é™ä½æ•£å¸ƒèƒ½åŠ›
- å¢å¼ºé˜²å¾¡ â†’ é™ä½ç”Ÿé•¿é€Ÿåº¦

=== è¾“å‡ºæ ¼å¼ ===
{{
    "results": [
        {{
            "request_id": "è¯·æ±‚IDï¼ˆä¸è¾“å…¥å¯¹åº”ï¼‰",
            "latin_name": "æ–°æ‹‰ä¸å­¦å",
            "common_name": "æ–°ä¸­æ–‡ä¿—å",
            "description": "100-120å­—æè¿°ï¼ŒåŒ…å«å½¢æ€å˜åŒ–ã€é€‚åº”æ€§åˆ›æ–°",
            "life_form_stage": å½“å‰é˜¶æ®µæˆ–+1ï¼ˆä¸å¯è·³çº§ï¼‰,
            "growth_form": "aquatic/moss/herb/shrub/tree",
            "habitat_type": "marine/freshwater/coastal/terrestrial",
            "trophic_level": 1.0-1.5,
            "key_innovations": ["åˆ›æ„æ¼”åŒ–ç‚¹"],
            "trait_changes": {{"å¢å¼ºç‰¹è´¨": "+æ•°å€¼", "å‡å¼±ç‰¹è´¨": "-æ•°å€¼"}},
            "morphology_changes": {{"body_length_cm": 0.8-1.3å€}},
            "new_organs": ["æ–°å™¨å®˜åç§°"],
            "organ_changes": [
                {{
                    "category": "å™¨å®˜ç±»åˆ«",
                    "change_type": "new/enhance",
                    "organ_name": "å™¨å®˜å",
                    "parameters": {{"å‚æ•°": å€¼}}
                }}
            ],
            "milestone_triggered": "é‡Œç¨‹ç¢‘IDæˆ–null",
            "event_description": "30-50å­—åˆ†åŒ–æ‘˜è¦",
            "rationale": "æ¼”åŒ–æœºåˆ¶è§£é‡Š"
        }}
    ]
}}

=== ç¤ºä¾‹ï¼ˆé˜¶æ®µ2ç¾¤ä½“è—»ç±»å‡†å¤‡ç™»é™†ï¼‰===
{{
    "results": [
        {{
            "request_id": "req_001",
            "latin_name": "Bryophytella primordialis",
            "common_name": "åŸå§‹è‹”è—“ä½“",
            "description": "é¦–æ‰¹ç™»é™†çš„æ¤ç‰©å…ˆé©±ï¼Œä»æ½®é—´å¸¦å‘å†…é™†æ‰©å±•ã€‚å‘å±•å‡ºåŸå§‹è§’è´¨å±‚å‡å°‘æ°´åˆ†æ•£å¤±ï¼Œå‡æ ¹å›ºç€äºå²©çŸ³ç¼éš™ã€‚å…‰åˆæ•ˆç‡ç•¥é™ï¼Œä½†è·å¾—é™†åœ°ç”Ÿå­˜çš„å…³é”®èƒ½åŠ›ã€‚",
            "life_form_stage": 3,
            "growth_form": "moss",
            "habitat_type": "coastal",
            "trophic_level": 1.0,
            "key_innovations": ["é¦–æ¬¡ç™»é™†é™†åœ°", "è§’è´¨å±‚ä¿æ°´"],
            "trait_changes": {{"ä¿æ°´èƒ½åŠ›": "+1.0", "è€æ—±æ€§": "+0.8", "å…‰åˆæ•ˆç‡": "-0.5", "ç¹æ®–é€Ÿåº¦": "-0.3"}},
            "morphology_changes": {{"body_length_cm": 1.2}},
            "new_organs": ["è§’è´¨å±‚", "å‡æ ¹"],
            "organ_changes": [
                {{"category": "protection", "change_type": "new", "organ_name": "è§’è´¨å±‚", "parameters": {{"uv_resist": 1.0, "drought_resist": 0.8}}}},
                {{"category": "root_system", "change_type": "new", "organ_name": "å‡æ ¹", "parameters": {{"depth_cm": 0.5, "absorption": 0.3}}}}
            ],
            "milestone_triggered": "first_land_plant",
            "event_description": "ç¾¤ä½“è—»ç±»æˆåŠŸç™»é™†ï¼Œæˆä¸ºè‹”è—“ç±»å…ˆé©±",
            "rationale": "æ½®é—´å¸¦å¹²æ¹¿äº¤æ›¿ç¯å¢ƒä¿ƒè¿›ä¿æ°´ç»“æ„æ¼”åŒ–"
        }}
    ]
}}

åªè¿”å›JSONå¯¹è±¡ï¼Œä¸è¦è¿”å›markdownã€‚
""",

    # ==================== é‡Œç¨‹ç¢‘å™äº‹ç”ŸæˆPrompt ====================
    "milestone_narrative": """ä½ æ˜¯è¿›åŒ–ç”Ÿç‰©å­¦ç§‘æ™®ä½œå®¶ï¼Œä¸ºæ¤ç‰©æ¼”åŒ–é‡Œç¨‹ç¢‘æ’°å†™å™äº‹ã€‚

**é‡è¦ï¼šåªè¿”å›çº¯JSONï¼Œä¸è¦markdownã€‚**

=== é‡Œç¨‹ç¢‘äº‹ä»¶ ===
é‡Œç¨‹ç¢‘ï¼š{milestone_name}
è§¦å‘ç‰©ç§ï¼š{species_name} ({lineage_code})
å‘ç”Ÿå›åˆï¼š{turn_index}
ä»é˜¶æ®µ {from_stage} è¿›åŒ–åˆ°é˜¶æ®µ {to_stage}

=== ç‰©ç§å˜åŒ– ===
{species_changes}

=== è¾“å‡ºæ ¼å¼ ===
{{
    "title": "é‡Œç¨‹ç¢‘æ ‡é¢˜ï¼ˆ10å­—ä»¥å†…ï¼‰",
    "narrative": "100-150å­—çš„å™äº‹æè¿°ï¼Œç”¨ç”ŸåŠ¨çš„è¯­è¨€æè¿°è¿™ä¸€æ¼”åŒ–çªç ´çš„æ„ä¹‰",
    "ecological_impact": "50å­—å†…æè¿°å¯¹ç”Ÿæ€ç³»ç»Ÿçš„å½±å“",
    "historical_parallel": "30å­—å†…çš„åœ°çƒå†å²å¯¹ç…§ï¼ˆå¦‚'ç±»ä¼¼äºXäº¿å¹´å‰çš„Yäº‹ä»¶'ï¼‰"
}}

åªè¿”å›JSONå¯¹è±¡ã€‚
"""
}


def get_plant_prompt(prompt_type: str) -> str:
    """è·å–æ¤ç‰©Promptæ¨¡æ¿
    
    Args:
        prompt_type: Promptç±»å‹
        
    Returns:
        Promptæ¨¡æ¿å­—ç¬¦ä¸²
    """
    return PLANT_PROMPTS.get(prompt_type, "")


def format_plant_traits_summary(traits: dict[str, float]) -> str:
    """æ ¼å¼åŒ–æ¤ç‰©ç‰¹è´¨æ‘˜è¦
    
    Args:
        traits: ç‰¹è´¨å­—å…¸
        
    Returns:
        æ ¼å¼åŒ–çš„å­—ç¬¦ä¸²
    """
    lines = []
    
    # æŒ‰ç±»åˆ«åˆ†ç»„
    categories = {
        "ç¯å¢ƒé€‚åº”": ["è€å¯’æ€§", "è€çƒ­æ€§", "è€æ—±æ€§", "è€ç›æ€§", "å…‰ç…§éœ€æ±‚"],
        "å…‰åˆä»£è°¢": ["å…‰åˆæ•ˆç‡", "å›ºç¢³èƒ½åŠ›"],
        "ç»“æ„å‘è‚²": ["å¤šç»†èƒç¨‹åº¦", "æ ¹ç³»å‘è¾¾åº¦", "ä¿æ°´èƒ½åŠ›", "å…»åˆ†å¸æ”¶", "æœ¨è´¨åŒ–ç¨‹åº¦"],
        "ç¹æ®–ä¼ æ’­": ["ç¹æ®–é€Ÿåº¦", "ç§å­åŒ–ç¨‹åº¦", "æ•£å¸ƒèƒ½åŠ›"],
        "é˜²å¾¡æœºåˆ¶": ["åŒ–å­¦é˜²å¾¡", "ç‰©ç†é˜²å¾¡"],
    }
    
    for cat_name, trait_names in categories.items():
        cat_traits = []
        for name in trait_names:
            if name in traits:
                value = traits[name]
                cat_traits.append(f"{name}={value:.1f}")
        if cat_traits:
            lines.append(f"  {cat_name}: {', '.join(cat_traits)}")
    
    return "\n".join(lines) if lines else "  æ— ç‰¹è´¨æ•°æ®"


def format_plant_organs_summary(organs: dict) -> str:
    """æ ¼å¼åŒ–æ¤ç‰©å™¨å®˜æ‘˜è¦
    
    Args:
        organs: å™¨å®˜å­—å…¸
        
    Returns:
        æ ¼å¼åŒ–çš„å­—ç¬¦ä¸²
    """
    if not organs:
        return "  æ— å™¨å®˜æ•°æ®"
    
    lines = []
    for category, organ_data in organs.items():
        if isinstance(organ_data, dict):
            organ_type = organ_data.get("type", "æœªçŸ¥")
            params = organ_data.get("parameters", {})
            params_str = ", ".join([f"{k}={v}" for k, v in params.items()])
            lines.append(f"  {category}: {organ_type} ({params_str})")
    
    return "\n".join(lines) if lines else "  æ— å™¨å®˜æ•°æ®"

