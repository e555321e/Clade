# Simulation Pipeline Stage Configuration
# 模拟流水线阶段配置

# 当前使用的模式
mode: standard

# 模式定义
modes:
  # 极简模式 - 仅核心功能
  minimal:
    description: "极简模式：仅保留压力、简单死亡率、繁殖"
    stages:
      - name: init
        enabled: true
        order: 0
      - name: parse_pressures
        enabled: true
        order: 10
      - name: map_evolution
        enabled: true
        order: 20
      - name: tectonic_movement
        enabled: false
        order: 25
      - name: fetch_species
        enabled: true
        order: 30
      - name: food_web
        enabled: false
        order: 35
      - name: tiering_and_niche
        enabled: true
        order: 40
      - name: preliminary_mortality
        enabled: true
        order: 50
      - name: prey_distribution
        enabled: false
        order: 55
      - name: migration
        enabled: true
        order: 60
      - name: dispersal
        enabled: false
        order: 65
      - name: hunger_migration
        enabled: false
        order: 66
      - name: post_migration_niche
        enabled: true
        order: 70
      - name: final_mortality
        enabled: true
        order: 80
      - name: ecological_intelligence
        enabled: false  # 极简模式禁用
        order: 52  # 在初步死亡率(50)后、迁徙(60)前，使AI能影响迁徙决策
      - name: ai_status_eval
        enabled: false
        order: 85
      - name: speciation_data_transfer
        enabled: false
        order: 86
      - name: population_update
        enabled: true
        order: 90
      - name: gene_activation
        enabled: false
        order: 95
      - name: gene_flow
        enabled: false
        order: 100
      - name: genetic_drift
        enabled: false
        order: 105
      - name: auto_hybridization
        enabled: false
        order: 110
      - name: subspecies_promotion
        enabled: false
        order: 115
      - name: ai_parallel_tasks
        enabled: false
        order: 120
      - name: background_management
        enabled: false
        order: 130
      - name: build_report
        enabled: true
        order: 140
      - name: save_map_snapshot
        enabled: true
        order: 150
      - name: vegetation_cover
        enabled: false
        order: 155
      - name: save_population_snapshot
        enabled: true
        order: 160
      - name: embedding_hooks
        enabled: false
        order: 165
      - name: embedding_plugins
        enabled: false  # 极简模式禁用
        order: 166
      - name: save_history
        enabled: true
        order: 170
      - name: export_data
        enabled: true
        order: 175
      - name: finalize
        enabled: true
        order: 180

  # 标准模式 - 推荐设置
  standard:
    description: "标准模式：保留主流程，禁用最重的AI阶段"
    stages:
      - name: init
        enabled: true
        order: 0
      - name: parse_pressures
        enabled: true
        order: 10
      - name: map_evolution
        enabled: true  # 海平面、气候变化
        order: 20
      - name: tectonic_movement
        enabled: false  # 禁用板块运动（地形不变）
        order: 25
      - name: fetch_species
        enabled: true
        order: 30
      - name: food_web
        enabled: true
        order: 35
      - name: tiering_and_niche
        enabled: true
        order: 40
      - name: preliminary_mortality
        enabled: true
        order: 50
      - name: prey_distribution
        enabled: true
        order: 55
      - name: migration
        enabled: true
        order: 60
      - name: dispersal
        enabled: true
        order: 65
      - name: hunger_migration
        enabled: true
        order: 66
      - name: post_migration_niche
        enabled: true
        order: 70
      - name: final_mortality
        enabled: true
        order: 80
      - name: ecological_intelligence
        enabled: true  # 生态智能体评估
        order: 52  # 在初步死亡率(50)后、迁徙(60)前，使AI能影响迁徙决策
      - name: ai_status_eval
        enabled: false  # 禁用旧版AI状态评估（已被生态智能体替代）
        order: 85
      - name: speciation_data_transfer
        enabled: true
        order: 86
      - name: population_update
        enabled: true
        order: 90
      - name: gene_activation
        enabled: true
        order: 95
      - name: gene_flow
        enabled: true
        order: 100
      - name: genetic_drift
        enabled: true
        order: 105
      - name: auto_hybridization
        enabled: false  # 禁用自动杂交
        order: 110
      - name: subspecies_promotion
        enabled: true
        order: 115
      - name: ai_parallel_tasks
        enabled: false  # 禁用AI并行任务
        order: 120
      - name: adaptation
        enabled: false  # 禁用适应性演化（依赖AI）
        order: 121
      - name: speciation
        enabled: false  # 禁用物种分化（依赖AI）
        order: 122
      - name: background_management
        enabled: true
        order: 130
      - name: build_report
        enabled: true
        order: 140
      - name: save_map_snapshot
        enabled: true
        order: 150
      - name: vegetation_cover
        enabled: true
        order: 155
      - name: save_population_snapshot
        enabled: true
        order: 160
      - name: embedding_hooks
        enabled: true  # 标准模式启用 Embedding
        order: 165
      - name: embedding_plugins
        enabled: true  # 标准模式启用插件
        order: 166
        plugins:
          behavior_strategy:
            enabled: true
            update_frequency: 2
          food_web:
            enabled: true
            update_frequency: 1
          tile_biome:
            enabled: true
            update_frequency: 3
          prompt_optimizer:
            enabled: false  # 标准模式禁用，减少开销
          evolution_space:
            enabled: false
          ancestry:
            enabled: false
      - name: save_history
        enabled: true
        order: 170
      - name: export_data
        enabled: true
        order: 175
      - name: finalize
        enabled: true
        order: 180

  # 全功能模式 - 使用新生态智能体架构
  full:
    description: "全功能模式：使用生态智能体统一修正，禁用旧AI数值Stage"
    stages:
      - name: init
        enabled: true
        order: 0
      - name: parse_pressures
        enabled: true
        order: 10
      - name: map_evolution
        enabled: true
        order: 20
      - name: tectonic_movement
        enabled: true
        order: 25
      - name: fetch_species
        enabled: true
        order: 30
      - name: food_web
        enabled: true
        order: 35
      - name: tiering_and_niche
        enabled: true
        order: 40
      - name: preliminary_mortality
        enabled: true
        order: 50
      - name: prey_distribution
        enabled: true
        order: 55
      - name: migration
        enabled: true
        order: 60
      - name: dispersal
        enabled: true
        order: 65
      - name: hunger_migration
        enabled: true
        order: 66
      - name: post_migration_niche
        enabled: true
        order: 70
      - name: final_mortality
        enabled: true
        order: 80
      - name: ecological_intelligence
        enabled: true  # 生态智能体评估（新架构唯一数值修正来源）
        order: 52  # 在初步死亡率(50)后、迁徙(60)前，使AI能影响迁徙决策
      - name: ai_status_eval
        enabled: false  # [已废弃] 被 ecological_intelligence 替代
        order: 85
      - name: speciation_data_transfer
        enabled: true
        order: 86
      - name: population_update
        enabled: true
        order: 90
      - name: gene_activation
        enabled: true
        order: 95
      - name: gene_flow
        enabled: true
        order: 100
      - name: genetic_drift
        enabled: true
        order: 105
      - name: auto_hybridization
        enabled: true
        order: 110
      - name: subspecies_promotion
        enabled: true
        order: 115
      - name: ai_parallel_tasks
        enabled: false  # [已废弃] 叙事由 ecological_intelligence 生成
        order: 120
      - name: adaptation
        enabled: false  # [已废弃] 数值修改迁移到 ModifierApplicator
        order: 121
      - name: speciation
        enabled: false  # [已废弃] 分化信号由 ModifierApplicator 提供
        order: 122
      - name: background_management
        enabled: true
        order: 130
      - name: build_report
        enabled: true
        order: 140
      - name: save_map_snapshot
        enabled: true
        order: 150
      - name: vegetation_cover
        enabled: true
        order: 155
      - name: save_population_snapshot
        enabled: true
        order: 160
      - name: embedding_hooks
        enabled: true
        order: 165
      - name: embedding_plugins
        enabled: true  # 全功能模式启用插件
        order: 166
        plugins:
          behavior_strategy:
            enabled: true
            update_frequency: 1
            params:
              similarity_threshold: 0.7
          food_web:
            enabled: true
            update_frequency: 1
            params:
              stability_threshold: 0.4
          tile_biome:
            enabled: true
            update_frequency: 2
          prompt_optimizer:
            enabled: true
            update_frequency: 1
            params:
              max_tokens: 1000
          evolution_space:
            enabled: true
            update_frequency: 5
            params:
              cluster_interval: 5
          ancestry:
            enabled: true
            update_frequency: 2
      - name: save_history
        enabled: true
        order: 170
      - name: export_data
        enabled: true
        order: 175
      - name: finalize
        enabled: true
        order: 180

  # 调试模式 - 包含性能分析
  debug:
    description: "调试模式：专用调试Stage，打印更多日志"
    stages:
      - name: init
        enabled: true
        order: 0
      - name: stage_profiling_start
        enabled: true
        order: 1
        params:
          log_level: DEBUG
      - name: parse_pressures
        enabled: true
        order: 10
      - name: map_evolution
        enabled: true
        order: 20
      - name: tectonic_movement
        enabled: true
        order: 25
      - name: fetch_species
        enabled: true
        order: 30
      - name: food_web
        enabled: true
        order: 35
      - name: tiering_and_niche
        enabled: true
        order: 40
      - name: preliminary_mortality
        enabled: true
        order: 50
      - name: prey_distribution
        enabled: true
        order: 55
      - name: migration
        enabled: true
        order: 60
      - name: dispersal
        enabled: true
        order: 65
      - name: hunger_migration
        enabled: true
        order: 66
      - name: post_migration_niche
        enabled: true
        order: 70
      - name: final_mortality
        enabled: true
        order: 80
      - name: ecological_intelligence
        enabled: true  # 生态智能体评估（调试模式启用完整输出）
        order: 52  # 在初步死亡率(50)后、迁徙(60)前，使AI能影响迁徙决策
      - name: ai_status_eval
        enabled: false  # [已废弃] 被 ecological_intelligence 替代
        order: 85
      - name: speciation_data_transfer
        enabled: true
        order: 86
      - name: population_update
        enabled: true
        order: 90
      - name: gene_activation
        enabled: true
        order: 95
      - name: gene_flow
        enabled: true
        order: 100
      - name: genetic_drift
        enabled: true
        order: 105
      - name: auto_hybridization
        enabled: true
        order: 110
      - name: subspecies_promotion
        enabled: true
        order: 115
      - name: ai_parallel_tasks
        enabled: false  # [已废弃] 叙事由 ecological_intelligence 生成
        order: 120
      - name: adaptation
        enabled: false  # [已废弃] 数值修改迁移到 ModifierApplicator
        order: 121
      - name: speciation
        enabled: false  # [已废弃] 分化信号由 ModifierApplicator 提供
        order: 122
      - name: background_management
        enabled: true
        order: 130
      - name: build_report
        enabled: true
        order: 140
      - name: save_map_snapshot
        enabled: true
        order: 150
      - name: vegetation_cover
        enabled: true
        order: 155
      - name: save_population_snapshot
        enabled: true
        order: 160
      - name: embedding_hooks
        enabled: true
        order: 165
      - name: embedding_plugins
        enabled: true  # 调试模式启用全部插件
        order: 166
        plugins:
          behavior_strategy:
            enabled: true
            update_frequency: 1
          food_web:
            enabled: true
            update_frequency: 1
          tile_biome:
            enabled: true
            update_frequency: 1
          prompt_optimizer:
            enabled: true
            update_frequency: 1
          evolution_space:
            enabled: true
            update_frequency: 1
          ancestry:
            enabled: true
            update_frequency: 1
      - name: save_history
        enabled: true
        order: 170
      - name: export_data
        enabled: true
        order: 175
      - name: stage_profiling_end
        enabled: true
        order: 179
        params:
          output_format: table
      - name: finalize
        enabled: true
        order: 180

