# æ¨¡æ‹Ÿå¼•æ“å¼ é‡åŒ–é‡æ„è®¾è®¡æ–‡æ¡£

## 1. æ¦‚è¿°

æœ¬æ–‡æ¡£æè¿°å°† `Clade` é¡¹ç›®çš„æ ¸å¿ƒæ¨¡æ‹Ÿå¼•æ“ä»**åŸºäºå¯¹è±¡ï¼ˆObject-Basedï¼‰**æ¶æ„è¿ç§»åˆ°**åŸºäºå¼ é‡ï¼ˆTensor-Basedï¼‰**è®¡ç®—æ¶æ„çš„å®Œæ•´æ–¹æ¡ˆã€‚

### 1.1 æ ¸å¿ƒç›®æ ‡

1. **å‡å°‘ LLM ä½¿ç”¨**ï¼šå°†ç¯å¢ƒé€‚åº”åº¦åˆ¤å®šã€åˆ†åŒ–ä¿¡å·æ£€æµ‹ç­‰æ•°å€¼è®¡ç®—ä» LLM è¿ç§»åˆ°å¼ é‡ç³»ç»Ÿ
2. **å‹ç¼©ä¸Šä¸‹æ–‡**ï¼šLLM åªè´Ÿè´£åˆ›æ„ç”Ÿæˆï¼Œä¸å†å¤„ç†æ•°å€¼çº¦æŸ
3. **ä¿æŒåˆ›æ„è‡ªç”±**ï¼šLLM å¯ä»¥è‡ªç”±åˆ›é€ æ–°å™¨å®˜ã€æ–°èƒ½åŠ›ï¼Œç³»ç»Ÿè‡ªåŠ¨è®¡ç®—ä»£ä»·

### 1.2 æ”¹é€ æ•ˆæœé¢„ä¼°

| æŒ‡æ ‡ | æ”¹é€ å‰ | æ”¹é€ å | å‰Šå‡æ¯”ä¾‹ |
|------|--------|--------|----------|
| æ¯å›åˆ LLM è°ƒç”¨æ¬¡æ•° | ~70æ¬¡ | ~2-4æ¬¡ | **94-97%** |
| å•æ¬¡åˆ†åŒ– Prompt Token | ~2500 | ~800 | **68%** |
| æ¯å›åˆæ€» Token | ~70,000 | ~2,000-4,000 | **94-97%** |

> **å½“å‰çŠ¶æ€**ï¼šLLM ä»…åœ¨åˆ†åŒ–ç”Ÿæˆå’Œå›åˆæŠ¥å‘Šæ—¶è°ƒç”¨ï¼Œæ‰€æœ‰æ•°å€¼è®¡ç®—å·²å®Œå…¨å¼ é‡åŒ–ã€‚

---

## 2. ç°çŠ¶åˆ†æ (As-Is)

### 2.1 æ•°æ®ç»“æ„
å½“å‰ç³»ç»Ÿä¸»è¦ä¾èµ– **SQLModel/Pydantic å¯¹è±¡** æ¥è¡¨ç¤ºæ¨¡æ‹ŸçŠ¶æ€ï¼š
- **åœ°å›¾**: `list[MapTile]`ï¼Œæ¯ä¸ª `MapTile` åŒ…å« `temperature`, `elevation`, `moisture` ç­‰å±æ€§
- **ç§ç¾¤**: `list[HabitatPopulation]`ï¼Œè®°å½•ç‰©ç§åœ¨ç‰¹å®šåœ°å—çš„åˆ†å¸ƒ
- **ä¸Šä¸‹æ–‡**: `SimulationContext` åœ¨å›åˆå†…ä¼ é€’åŒ…å«æ•°ä¸‡ä¸ªå¯¹è±¡çš„åˆ—è¡¨

### 2.2 LLM è¿‡åº¦ä½¿ç”¨é—®é¢˜

å½“å‰ç³»ç»Ÿåœ¨ä»¥ä¸‹åœºæ™¯è°ƒç”¨ LLMï¼š

| åœºæ™¯ | è°ƒç”¨é¢‘ç‡ | é—®é¢˜ |
|------|----------|------|
| çŠ¶æ€è¯„ä¼° (mortality_modifier) | æ¯ç‰©ç§/æ¯å›åˆ | çº¯æ•°å€¼è®¡ç®—ï¼Œä¸éœ€è¦åˆ›æ„ |
| æ™ºèƒ½é€‚åº” (pressure_adaptation) | é«˜å‹åŠ›æ—¶è§¦å‘ | å¯ç”¨æ•°å­¦å…¬å¼æ›¿ä»£ |
| åˆ†åŒ–åˆ¤å®š (speciation_signal) | æ¯ç‰©ç§/æ¯å›åˆ | å¯ç”¨å¼ é‡æ£€æµ‹æ›¿ä»£ |
| åˆ†åŒ–ç”Ÿæˆ | è§¦å‘æ—¶ | **éœ€è¦ä¿ç•™**ï¼Œä½† Prompt è¿‡é•¿ |
| å›åˆæŠ¥å‘Š | æ¯å›åˆ | **éœ€è¦ä¿ç•™** |

### 2.3 ç—›ç‚¹æ€»ç»“

1. **è½¬æ¢å¼€é”€**: æ¯å›åˆåœ¨"æ•°æ®åº“å¯¹è±¡" â†’ "Pythonå¯¹è±¡" â†’ "NumPyçŸ©é˜µ" â†’ "Pythonå¯¹è±¡"ä¹‹é—´åå¤è½¬æ¢
2. **LLM ç“¶é¢ˆ**: LLM å¤„ç†å¤§é‡å†—é•¿çš„ä¸Šä¸‹æ–‡ï¼Œæ‰¿æ‹…äº†è¿‡å¤šçš„æ•°å€¼å¾®è°ƒå·¥ä½œ
3. **Prompt å†—ä½™**: åˆ†åŒ– Prompt çº¦ 500 è¡Œï¼Œå…¶ä¸­ 60% æ˜¯æ•°å€¼çº¦æŸè§„åˆ™
4. **åˆ›æ„å—é™**: LLM æ—¢è¦è®¡ç®—æ•°å€¼åˆè¦ç”Ÿæˆåˆ›æ„ï¼Œä¸¤è€…äº’ç›¸å¹²æ‰°

---

## 3. ç›®æ ‡æ¶æ„ (To-Be)

### 3.1 æ ¸å¿ƒæ¦‚å¿µï¼šåŒè½¨åˆ¶æ¼”åŒ–

å°†æ¼”åŒ–åˆ†ä¸ºä¸¤æ¡æ˜ç¡®çš„è½¨é“ï¼Œè§£å†³"æ•°å€¼å¿«ã€åˆ›æ„æ…¢"çš„çŸ›ç›¾ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           åŒè½¨åˆ¶æ¼”åŒ–æ¶æ„                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              è½¨é“ä¸€ï¼šå¾®è°ƒä¸ç”Ÿå­˜ (Adaptation Track)                   â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  é¢‘ç‡: 90% çš„å›åˆ/ç‰©ç§                                               â”‚   â”‚
â”‚  â”‚  æ‰§è¡Œè€…: å¼ é‡ç³»ç»Ÿ (æ¯«ç§’çº§)                                           â”‚   â”‚
â”‚  â”‚  å†…å®¹:                                                              â”‚   â”‚
â”‚  â”‚    â€¢ ç¯å¢ƒå‹åŠ›è®¡ç®—                                                   â”‚   â”‚
â”‚  â”‚    â€¢ æ­»äº¡ç‡è®¡ç®—                                                     â”‚   â”‚
â”‚  â”‚    â€¢ å¾®è§‚æ¼”åŒ–ï¼ˆå±æ€§å¾®è°ƒ Â±0.1ï¼‰                                      â”‚   â”‚
â”‚  â”‚    â€¢ è¿å¾™æ‰©æ•£                                                       â”‚   â”‚
â”‚  â”‚    â€¢ åˆ†åŒ–ä¿¡å·æ£€æµ‹                                                   â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  ç‰¹ç‚¹: æ—  LLM ä»‹å…¥ï¼Œä¸äº§ç”Ÿæ–°ç‰©ç§                                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              è½¨é“äºŒï¼šåˆ†åŒ–ä¸åˆ›æ–° (Speciation Track)                   â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  é¢‘ç‡: 10% çš„å…³é”®æ—¶åˆ» (0-5æ¬¡/å›åˆ)                                   â”‚   â”‚
â”‚  â”‚  æ‰§è¡Œè€…: LLM (ç§’çº§)                                                  â”‚   â”‚
â”‚  â”‚  å†…å®¹:                                                              â”‚   â”‚
â”‚  â”‚    â€¢ æ–°ç‰©ç§å‘½åï¼ˆæ‹‰ä¸å­¦å + ä¸­æ–‡ä¿—åï¼‰                               â”‚   â”‚
â”‚  â”‚    â€¢ ç”Ÿç‰©å­¦æè¿°ï¼ˆå½¢æ€ã€è¡Œä¸ºã€ç”Ÿæ€ä½ï¼‰                               â”‚   â”‚
â”‚  â”‚    â€¢ å…³é”®åˆ›æ–°ç‚¹ï¼ˆæ–°å™¨å®˜ã€æ–°èƒ½åŠ›ï¼‰+ å¢ç›Šæ•°å€¼                         â”‚   â”‚
â”‚  â”‚    â€¢ æ¼”åŒ–å™äº‹ï¼ˆä¸ºä»€ä¹ˆè¿™æ ·åˆ†åŒ–ï¼‰                                     â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  ç‰¹ç‚¹: LLM åªç»™å¢ç›Šï¼Œä»£ä»·ç”±ç³»ç»Ÿè‡ªåŠ¨è®¡ç®—                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 ä¸–ç•Œå¼ é‡ (World Tensor)

#### A. ç¯å¢ƒå¼ é‡ (Environment Tensor)
- **Shape**: `(C, H, W)`ï¼Œå…¶ä¸­ C ä¸ºé€šé“æ•°ï¼ŒH/W ä¸ºåœ°å›¾é«˜å®½
- **DType**: `float32`

| Channel | Name | Unit/Range | Description |
|---------|------|------------|-------------|
| 0 | ELEVATION | Meters | æµ·æ‹”é«˜åº¦ |
| 1 | TEMPERATURE | Â°C | åœ°è¡¨æ°”æ¸© |
| 2 | MOISTURE | [0, 1.0] | åœŸå£¤/ç©ºæ°”æ¹¿åº¦ |
| 3 | RADIATION | [0, 1.0] | è¾å°„æ°´å¹³ |
| 4 | VEGETATION | [0, 1.0] | æ¤è¢«è¦†ç›–ç‡ |

#### B. ç§ç¾¤å¼ é‡ (Population Tensor)
- **Shape**: `(S, H, W)`ï¼Œå…¶ä¸­ S ä¸ºæ´»è·ƒç‰©ç§æ•°é‡
- **DType**: `float32`
- **æ•°å€¼å«ä¹‰**: ç”Ÿç‰©é‡ï¼ˆBiomassï¼‰

#### C. ç‰©ç§å‚æ•°çŸ©é˜µ (Species Parameters)
- **Shape**: `(S, F)`ï¼Œå…¶ä¸­ F ä¸ºç‰¹è´¨æ•°é‡
- **å†…å®¹**: è€å¯’æ€§ã€è€çƒ­æ€§ã€ç¹æ®–é€Ÿåº¦ç­‰å‚æ•°
- **ä½œç”¨**: è¿™å°±æ˜¯"åŸºå› åº“"çš„æ•°å€¼è¡¨ç°

### 3.3 æ ¸å¿ƒè¿è¡Œæ—¶ç»“æ„

```python
@dataclass
class TensorState:
    """æ ¸å¿ƒè¿è¡Œæ—¶çŠ¶æ€å®¹å™¨"""
    # ç‰©ç†ç¯å¢ƒ (C, H, W)
    env: np.ndarray
    
    # ç”Ÿæ€ç§ç¾¤ (S, H, W)
    pop: np.ndarray
    
    # ç‰©ç§å‚æ•°çŸ©é˜µ (S, Features)
    species_params: np.ndarray
    
    # è¾…åŠ©æ©ç  (H, W)
    masks: dict[str, np.ndarray]
    
    # ç´¢å¼•æ˜ å°„
    species_map: dict[str, int]  # lineage_code -> tensor_index
```

---

## 4. æ¼”åŒ–é“¾è·¯é‡æ„

### 4.1 å®Œæ•´å›åˆæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           æ¯å›åˆæ¼”åŒ–æµç¨‹                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                        â”‚
â”‚  â”‚  1. ç¯å¢ƒæ›´æ–°     â”‚  â† çº¯å¼ é‡è®¡ç®—                                          â”‚
â”‚  â”‚  (æ¿å—/æ°”å€™)     â”‚    TectonicMatrixEngine + MapTensorManager            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                        â”‚
â”‚           â–¼                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                        â”‚
â”‚  â”‚  2. æ­»äº¡ç‡è®¡ç®—   â”‚  â† çº¯å¼ é‡è®¡ç®—                                          â”‚
â”‚  â”‚  (é€‚åº”åº¦è¯„ä¼°)    â”‚    TileBasedMortalityEngine                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    âŒ ä¸å†è°ƒç”¨ LLMOrchestrator                         â”‚
â”‚           â–¼                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                        â”‚
â”‚  â”‚  3. å¾®è°ƒæ¼”åŒ–     â”‚  â† çº¯å¼ é‡è®¡ç®—                                          â”‚
â”‚  â”‚  (æ¸è¿›é€‚åº”)      â”‚    AdaptationService._apply_gradual_evolution         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    âŒ ä¸å†è°ƒç”¨ LLM æ™ºèƒ½é€‚åº”                             â”‚
â”‚           â–¼                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                        â”‚
â”‚  â”‚  4. åˆ†åŒ–æ£€æµ‹     â”‚  â† çº¯å¼ é‡è®¡ç®—                                          â”‚
â”‚  â”‚                  â”‚    SpeciationMonitor.detect_isolation()               â”‚
â”‚  â”‚                  â”‚    SpeciationMonitor.detect_divergence()              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    âŒ ä¸å†ä¾èµ– LLM çš„ speciation_signal                 â”‚
â”‚           â–¼                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                        â”‚
â”‚  â”‚  5. åˆ†åŒ–ç”Ÿæˆ     â”‚  â† âœ… éœ€è¦ LLMï¼ˆç²¾ç®€ç‰ˆï¼‰                               â”‚
â”‚  â”‚  (0-5ä¸ªæ–°ç‰©ç§)   â”‚    ä»…ç”Ÿæˆï¼šå‘½åã€æè¿°ã€åˆ›æ–°ç‚¹ã€å¢ç›Š                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    ä»£ä»·ç”± TradeoffCalculator è‡ªåŠ¨è®¡ç®—                   â”‚
â”‚           â–¼                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                        â”‚
â”‚  â”‚  6. ç§ç¾¤æ›´æ–°     â”‚  â† çº¯å¼ é‡è®¡ç®—                                          â”‚
â”‚  â”‚  (ç¹æ®–/è¿å¾™)     â”‚    ReproductionService + MigrationService             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                        â”‚
â”‚           â–¼                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                        â”‚
â”‚  â”‚  7. å›åˆæŠ¥å‘Š     â”‚  â† âœ… éœ€è¦ LLM                                         â”‚
â”‚  â”‚  (1æ¬¡/å›åˆ)      â”‚    ç”Ÿæ€å™äº‹ã€é‡å¤§äº‹ä»¶æ€»ç»“                              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                        â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 LLM è°ƒç”¨ç‚¹ï¼ˆä»…å‰©2å¤„ï¼‰

```python
# æ•´ä¸ªç³»ç»Ÿåªåœ¨è¿™ä¸¤ä¸ªåœ°æ–¹è°ƒç”¨ LLMï¼š

class SpeciationService:
    async def generate_offspring(self, parent, trigger) -> Species:
        """âœ… LLMè°ƒç”¨ç‚¹1ï¼šåˆ†åŒ–ç”Ÿæˆ"""
        # ...

class ReportService:
    async def generate_turn_report(self, ctx) -> str:
        """âœ… LLMè°ƒç”¨ç‚¹2ï¼šå›åˆæŠ¥å‘Š"""
        # ...
```

---

## 5. åˆ†åŒ–ç”Ÿæˆæ¶æ„

### 5.1 æ ¸å¿ƒæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å¼ é‡ç³»ç»Ÿé¢„è®¡ç®—                           â”‚
â”‚                                                            â”‚
â”‚  è¾“å‡ºï¼šæ¼”åŒ–é¢„ç®— = {                                         â”‚
â”‚    "max_increase": 3.0,      // æ€»å¢ç›Šä¸Šé™                 â”‚
â”‚    "single_max": 2.0,        // å•é¡¹ä¸Šé™                   â”‚
â”‚    "era_caps": {"è€å¯’æ€§": 8, "è¿åŠ¨èƒ½åŠ›": 6, ...}           â”‚
â”‚  }                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      LLM åˆ›æ„ç”Ÿæˆ                           â”‚
â”‚                                                            â”‚
â”‚  è¾“å…¥ï¼šé¢„ç®—çº¦æŸ + åˆ†åŒ–èƒŒæ™¯                                  â”‚
â”‚  è¾“å‡ºï¼š{                                                   â”‚
â”‚    "å‘½å": "éœœæ™¶æ—‹è™«",                                     â”‚
â”‚    "æè¿°": "åŒ—éƒ¨å­ç¾¤æ¼”åŒ–å‡ºæŠ—å†»é€‚åº”...",                    â”‚
â”‚    "åˆ›æ–°": ["æŠ—å†»è›‹ç™½", "æ„Ÿæ¸©çº¤æ¯›"],                       â”‚
â”‚    "å¢ç›Š": {"è€å¯’æ€§": +1.5, "æ¸©åº¦æ„ŸçŸ¥": +0.8}              â”‚
â”‚  }                                                         â”‚
â”‚                                                            â”‚
â”‚  âš ï¸ LLM ä¸éœ€è¦è€ƒè™‘ä»£ä»·ï¼Œåªç®¡åˆ›æ„å’Œå¢ç›Šï¼                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               è‡ªåŠ¨ä»£ä»·è®¡ç®—å™¨ (TradeoffCalculator)           â”‚
â”‚                                                            â”‚
â”‚  è¾“å…¥ï¼šgains = {"è€å¯’æ€§": +1.5, "æ¸©åº¦æ„ŸçŸ¥": +0.8}          â”‚
â”‚  è§„åˆ™ï¼š                                                    â”‚
â”‚    1. ä»£ä»·æ€»é‡ = å¢ç›Šæ€»é‡ Ã— ä»£ä»·ç³»æ•° (0.6-0.8)             â”‚
â”‚    2. ä»"ç«äº‰å±æ€§æ± "ä¸­é€‰æ‹©ä»£ä»·ç›®æ ‡                          â”‚
â”‚    3. è€ƒè™‘ç”Ÿç‰©å­¦å…³è”æ€§ï¼ˆèƒ½é‡å®ˆæ’ï¼‰                          â”‚
â”‚  è¾“å‡ºï¼špenalties = {"ç¹æ®–é€Ÿåº¦": -0.9, "è€çƒ­æ€§": -0.6}      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 ç²¾ç®€åçš„åˆ†åŒ– Prompt

**ä» ~500 è¡Œå‹ç¼©åˆ° ~100 è¡Œ**ï¼š

```python
SPECIATION_CREATIVE_PROMPT = """ä½ æ˜¯æ¼”åŒ–ç”Ÿç‰©å­¦å®¶ï¼Œä¸ºç‰©ç§åˆ†åŒ–è®¾è®¡**åˆ›æ„æ€§æ¼”åŒ–å†…å®¹**ã€‚

=== ğŸ“Š æ¼”åŒ–é¢„ç®—ï¼ˆå¿…é¡»éµå®ˆï¼‰===
- æ€»å¢ç›Šä¸Šé™: {max_increase}
- å•é¡¹ä¸Šé™: {single_max}
- æ—¶ä»£å±æ€§ä¸Šé™: {era_caps}

=== ğŸ“‹ çˆ¶ç³»ç‰©ç§ ===
{parent_summary}

=== ğŸŒ åˆ†åŒ–èƒŒæ™¯ ===
{trigger_context}

=== ğŸ¨ ä½ çš„ä»»åŠ¡ ===
1. è®¾è®¡åˆ›æ„æ€§çš„æ¼”åŒ–å†…å®¹ï¼ˆæ–°å™¨å®˜ã€æ–°èƒ½åŠ›ã€å½¢æ€å˜åŒ–ï¼‰
2. ä¸ºæ¯ä¸ªåˆ›æ–°ç»™å‡º**å¢ç›Šæ•°å€¼**ï¼ˆåœ¨é¢„ç®—å†…ï¼‰
3. **ä¸éœ€è¦è€ƒè™‘ä»£ä»·**ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è®¡ç®—æƒè¡¡

=== è¾“å‡ºæ ¼å¼ ===
{{
    "latin_name": "å­¦å",
    "common_name": "ä¸­æ–‡ä¿—å",
    "description": "100-150å­—æè¿°",
    
    "innovations": [
        {{
            "name": "åˆ›æ–°åç§°",
            "type": "organ/ability/morphology",
            "description": "è¿™ä¸ªåˆ›æ–°å¦‚ä½•å¸®åŠ©ç”Ÿå­˜",
            "gains": {{"å±æ€§å": +æ•°å€¼}}
        }}
    ],
    
    "event_description": "åˆ†åŒ–å™äº‹"
}}

åªè¿”å›JSONã€‚
"""
```

### 5.3 è‡ªåŠ¨ä»£ä»·è®¡ç®—å™¨

```python
class TradeoffCalculator:
    """è‡ªåŠ¨è®¡ç®—æ¼”åŒ–ä»£ä»·ï¼ˆèƒ½é‡å®ˆæ’åŸåˆ™ï¼‰"""
    
    # å±æ€§çš„"èƒ½é‡æˆæœ¬"æƒé‡
    ENERGY_COSTS = {
        "è¿åŠ¨èƒ½åŠ›": 1.5,    # é«˜æˆæœ¬
        "æ™ºåŠ›": 2.0,
        "ç¹æ®–é€Ÿåº¦": 1.0,    # ä¸­ç­‰æˆæœ¬
        "è€å¯’æ€§": 0.6,      # ä½æˆæœ¬ï¼ˆè¢«åŠ¨å±æ€§ï¼‰
        "è€çƒ­æ€§": 0.6,
        "ç‰©ç†é˜²å¾¡": 0.7,
    }
    
    # å±æ€§ç«äº‰å…³ç³»
    COMPETITION_MAP = {
        "è¿åŠ¨èƒ½åŠ›": ["ç‰©ç†é˜²å¾¡", "ä½“å‹", "ç¹æ®–é€Ÿåº¦"],
        "ç‰©ç†é˜²å¾¡": ["è¿åŠ¨èƒ½åŠ›", "ç¹æ®–é€Ÿåº¦"],
        "è€å¯’æ€§": ["è€çƒ­æ€§", "ç¹æ®–é€Ÿåº¦"],
        "è€çƒ­æ€§": ["è€å¯’æ€§", "ç¹æ®–é€Ÿåº¦"],
        "æ™ºåŠ›": ["ç¹æ®–é€Ÿåº¦", "ä½“å‹"],
    }
    
    def __init__(self, tradeoff_ratio: float = 0.7):
        """
        Args:
            tradeoff_ratio: ä»£ä»·/å¢ç›Šæ¯”ä¾‹ (0.5-1.0)
                           0.7 è¡¨ç¤ºå¢åŠ 2ç‚¹éœ€è¦å‡å°‘1.4ç‚¹
        """
        self.tradeoff_ratio = tradeoff_ratio
    
    def calculate_penalties(
        self,
        gains: dict[str, float],
        parent_traits: dict[str, float],
    ) -> dict[str, float]:
        """
        è‡ªåŠ¨è®¡ç®—æ¼”åŒ–ä»£ä»·
        
        Args:
            gains: LLMç»™å‡ºçš„å¢ç›Š {"è€å¯’æ€§": +1.5}
            parent_traits: çˆ¶ç³»å½“å‰å±æ€§å€¼
        
        Returns:
            penalties: è‡ªåŠ¨è®¡ç®—çš„ä»£ä»· {"ç¹æ®–é€Ÿåº¦": -0.9}
        """
        exclude = set(gains.keys())  # å¢ç›Šå±æ€§ä¸èƒ½åŒæ—¶è¢«å‰Šå¼±
        
        # 1. è®¡ç®—éœ€è¦çš„æ€»ä»£ä»·é‡
        total_gain_cost = sum(
            delta * self.ENERGY_COSTS.get(trait, 1.0)
            for trait, delta in gains.items()
        )
        required_penalty = total_gain_cost * self.tradeoff_ratio
        
        # 2. ç¡®å®šä»£ä»·å€™é€‰æ± ï¼ˆä¼˜å…ˆé€‰æ‹©ç«äº‰å±æ€§ï¼‰
        penalty_candidates = self._get_penalty_candidates(gains, exclude)
        
        # 3. åˆ†é…ä»£ä»·
        penalties = {}
        remaining = required_penalty
        
        for trait in penalty_candidates:
            if remaining <= 0:
                break
            
            parent_val = parent_traits.get(trait, 5.0)
            max_reduction = min(parent_val * 0.3, 2.0, remaining)
            
            if max_reduction > 0.1:
                penalties[trait] = -round(max_reduction, 2)
                remaining -= max_reduction * self.ENERGY_COSTS.get(trait, 1.0)
        
        return penalties
    
    def _get_penalty_candidates(self, gains, exclude):
        """æ ¹æ®å¢ç›Šå±æ€§ç¡®å®šæœ€åˆé€‚çš„ä»£ä»·å€™é€‰"""
        candidates = []
        
        # ä¼˜å…ˆï¼šç›´æ¥ç«äº‰çš„å±æ€§
        for gain_trait in gains.keys():
            for comp in self.COMPETITION_MAP.get(gain_trait, []):
                if comp not in exclude and comp not in candidates:
                    candidates.append(comp)
        
        # è¡¥å……ï¼šé»˜è®¤æ± 
        for trait in ["ç¹æ®–é€Ÿåº¦", "è¿åŠ¨èƒ½åŠ›", "ç¤¾ä¼šæ€§"]:
            if trait not in exclude and trait not in candidates:
                candidates.append(trait)
        
        return candidates
```

### 5.4 ç¤ºä¾‹è¿è¡Œ

**è¾“å…¥**ï¼š
```python
trigger = SpeciationTrigger(
    type="geographic_isolation",
    narrative="å±±è„‰éš†èµ·å°†åŒ—éƒ¨å­ç¾¤éš”ç¦»ï¼Œæ¸©åº¦æŒç»­ä¸‹é™"
)
```

**LLM è¾“å‡º**ï¼š
```json
{
    "latin_name": "Protoflagella cryophila",
    "common_name": "æå¯’æ—‹è™«",
    "description": "åŒ—éƒ¨å­ç¾¤åœ¨å†°æœŸå‹åŠ›ä¸‹æ¼”åŒ–å‡ºæŠ—å†»é€‚åº”...",
    "innovations": [
        {
            "name": "æŠ—å†»ç³–è›‹ç™½",
            "gains": {"è€å¯’æ€§": +1.5}
        },
        {
            "name": "æ„Ÿæ¸©çº¤æ¯›", 
            "gains": {"æ¸©åº¦æ„ŸçŸ¥": +0.8, "è¿åŠ¨èƒ½åŠ›": +0.3}
        }
    ]
}
```

**ç³»ç»Ÿè‡ªåŠ¨è®¡ç®—ä»£ä»·**ï¼š
```python
gains = {"è€å¯’æ€§": +1.5, "æ¸©åº¦æ„ŸçŸ¥": +0.8, "è¿åŠ¨èƒ½åŠ›": +0.3}
# æ€»å¢ç›Š: 2.6

penalties = calculator.calculate_penalties(gains, parent.traits)
# => {"è€çƒ­æ€§": -0.6, "ç¹æ®–é€Ÿåº¦": -0.8, "ç¤¾ä¼šæ€§": -0.4}
# æ€»ä»£ä»·: 1.8 â‰ˆ 2.6 Ã— 0.7
```

**æœ€ç»ˆç»“æœ**ï¼š
```python
new_species.abstract_traits = {
    "è€å¯’æ€§": 7.5,      # +1.5 (LLMå¢ç›Š)
    "æ¸©åº¦æ„ŸçŸ¥": 5.8,    # +0.8 (LLMæ–°èƒ½åŠ›)
    "è¿åŠ¨èƒ½åŠ›": 5.3,    # +0.3 (LLMå¢ç›Š)
    "è€çƒ­æ€§": 5.4,      # -0.6 (ç³»ç»Ÿä»£ä»·)
    "ç¹æ®–é€Ÿåº¦": 6.2,    # -0.8 (ç³»ç»Ÿä»£ä»·)
    "ç¤¾ä¼šæ€§": 4.6,      # -0.4 (ç³»ç»Ÿä»£ä»·)
}
```

---

## 6. åˆ†åŒ–æ£€æµ‹æ¶æ„

### 6.1 SpeciationMonitorï¼ˆå¼ é‡ç›‘æ§å™¨ï¼‰

æ›¿ä»£ LLM çš„ `speciation_signal` åˆ¤å®šï¼š

```python
class SpeciationMonitor:
    """å¼ é‡ç›‘æ§å™¨ - æ£€æµ‹åˆ†åŒ–ä¿¡å·"""
    
    def detect_isolation(
        self, 
        pop_tensor: np.ndarray,  # (S, H, W)
        masks: dict[str, np.ndarray]
    ) -> dict[str, list[np.ndarray]]:
        """æ£€æµ‹åœ°ç†éš”ç¦»ï¼ˆå¼‚åŸŸåˆ†åŒ–ï¼‰"""
        from scipy.ndimage import label
        
        isolation_regions = {}
        for s_idx, lineage in enumerate(self.species_map.keys()):
            presence = pop_tensor[s_idx] > 0
            labeled, num_regions = label(presence)
            
            if num_regions >= 2:
                # æ£€æµ‹åˆ°åˆ†å‰²çš„ç§ç¾¤
                isolation_regions[lineage] = [
                    labeled == r for r in range(1, num_regions + 1)
                ]
        
        return isolation_regions
    
    def detect_divergence(
        self,
        pop_tensor: np.ndarray,
        env_tensor: np.ndarray,
    ) -> dict[str, float]:
        """æ£€æµ‹ç§ç¾¤å†…éƒ¨ç¯å¢ƒå·®å¼‚ï¼ˆç”Ÿæ€åˆ†åŒ–ï¼‰"""
        divergence_scores = {}
        
        for s_idx, lineage in enumerate(self.species_map.keys()):
            presence = pop_tensor[s_idx] > 0
            if not presence.any():
                continue
            
            # è®¡ç®—åˆ†å¸ƒåŒºåŸŸçš„ç¯å¢ƒæ–¹å·®
            env_in_range = env_tensor[:, presence]
            variance = np.var(env_in_range, axis=1).mean()
            
            # å½’ä¸€åŒ–ä¸º 0-1 åˆ†åŒ–ä¿¡å·
            divergence_scores[lineage] = min(1.0, variance / 10.0)
        
        return divergence_scores
    
    def get_speciation_triggers(
        self,
        tensor_state: TensorState,
        threshold: float = 0.5
    ) -> list[SpeciationTrigger]:
        """æ±‡æ€»æ‰€æœ‰åˆ†åŒ–è§¦å‘ä¿¡å·"""
        triggers = []
        
        # 1. åœ°ç†éš”ç¦»æ£€æµ‹
        isolation = self.detect_isolation(tensor_state.pop, tensor_state.masks)
        for lineage, regions in isolation.items():
            triggers.append(SpeciationTrigger(
                lineage_code=lineage,
                type="geographic_isolation",
                num_regions=len(regions),
                regions=regions
            ))
        
        # 2. ç¯å¢ƒåˆ†æ­§æ£€æµ‹
        divergence = self.detect_divergence(tensor_state.pop, tensor_state.env)
        for lineage, score in divergence.items():
            if score >= threshold:
                triggers.append(SpeciationTrigger(
                    lineage_code=lineage,
                    type="ecological_divergence",
                    divergence_score=score
                ))
        
        return triggers
```

---

## 7. å¼€å‘å®æ–½è·¯çº¿å›¾

### Phase 1ï¼šä¸Šä¸‹æ–‡å‹ç¼©ï¼ˆ2å‘¨ï¼‰
**ç›®æ ‡**ï¼šå‡å°‘ Prompt é•¿åº¦ï¼Œä¸æ”¹å˜æ ¸å¿ƒé€»è¾‘

1. å®ç° `TensorSemanticAdapter` - é«˜å¯†åº¦ä¸Šä¸‹æ–‡ç”Ÿæˆ
2. é‡å†™åˆ†åŒ– Prompt - ä» 500 è¡Œå‹ç¼©åˆ° 100 è¡Œ
3. å®ç° `TradeoffCalculator` - è‡ªåŠ¨ä»£ä»·è®¡ç®—
4. ç§»é™¤ Prompt ä¸­çš„æ•°å€¼çº¦æŸè¯´æ˜
5. æ”¶æ•› LLM è°ƒç”¨ï¼šé»˜è®¤å…³é—­ AIStatusEval/AINarrative é«˜é¢‘è°ƒç”¨ï¼Œé€‚åº”æ€§æ™ºèƒ½é€‚åº”ä»…åœ¨æé«˜å‹åŠ›è§¦å‘å¹¶å—å¼€å…³æ§åˆ¶

**éªŒæ”¶æ ‡å‡†**ï¼šåˆ†åŒ– Token æ¶ˆè€—å‡å°‘ 60%

### Phase 2ï¼šç§»é™¤ LLM çŠ¶æ€è¯„ä¼°ï¼ˆ2å‘¨ï¼‰
**ç›®æ ‡**ï¼šæ­»äº¡ç‡è®¡ç®—å®Œå…¨å¼ é‡åŒ–

1. æ‰©å±• `TileBasedMortalityEngine` - æ·»åŠ é€‚åº”åº¦è®¡ç®—
2. ç§»é™¤ `LLMOrchestrator` çš„ `mortality_modifier` èŒè´£
3. åˆ é™¤ `species_status_eval` Prompt
4. åˆ é™¤ `pressure_adaptation` Prompt
5. å¼•å…¥ TensorState å½±å­è·¯å¾„ï¼šTileBasedMortalityEngine è¾“å‡ºå¼ é‡å­˜æ´»ç‡å¹¶åŒå†™ Species å¯¹è±¡ï¼›PopulationUpdateStage è¯»å–å¼ é‡ç»“æœï¼Œä¿æŒæ—§æ¥å£å…¼å®¹

**éªŒæ”¶æ ‡å‡†**ï¼šLLM è°ƒç”¨æ¬¡æ•°å‡å°‘ 90%

### Phase 3ï¼šå®ç°å¼ é‡åˆ†åŒ–æ£€æµ‹ï¼ˆ2å‘¨ï¼‰
**ç›®æ ‡**ï¼šåˆ†åŒ–åˆ¤å®šå®Œå…¨å¼ é‡åŒ–

1. å®ç° `SpeciationMonitor` - åœ°ç†éš”ç¦»æ£€æµ‹
2. å®ç°ç¯å¢ƒåˆ†æ­§æ£€æµ‹
3. ç§»é™¤ LLM çš„ `speciation_signal`
4. é›†æˆåˆ°ä¸»æµç¨‹
5. å°† SpeciationMonitor äº§å‡ºçš„å€™é€‰å†™å…¥ `SpeciationService`ï¼ŒAI åˆ†åŒ–ä¿¡å·ä»…ä½œå›é€€/å¯¹ç…§

**éªŒæ”¶æ ‡å‡†**ï¼šåˆ†åŒ–è§¦å‘å‡†ç¡®ç‡ â‰¥ 95%

### Phase 4ï¼šå®Œæ•´ TensorStateï¼ˆ3å‘¨ï¼‰
**ç›®æ ‡**ï¼šå»ºç«‹ç»Ÿä¸€çš„å¼ é‡çŠ¶æ€ç®¡ç†

1. å®ç° `TensorState` æ•°æ®ç»“æ„
2. å®ç° `MapTensorManager` - ç¯å¢ƒå¼ é‡ç®¡ç†
3. å®ç° `PopulationTensorManager` - ç§ç¾¤å¼ é‡ç®¡ç†
4. æ•°æ®åº“åŒæ­¥æœºåˆ¶
5. åœ¨ `get_default_stages` é¢„ç•™/æ¥å…¥å¼ é‡é˜¶æ®µï¼Œå™äº‹/æŠ¥å‘Šç±» LLM é˜¶æ®µå¯å¼‚æ­¥æ‰§è¡Œï¼Œé¿å…é˜»å¡å¼ é‡è·¯å¾„

**éªŒæ”¶æ ‡å‡†**ï¼šå›åˆè®¡ç®—æ—¶é—´å‡å°‘ 50%

---

## 8. å…¼å®¹ç­–ç•¥

### 8.1 åŒè½¨åˆ¶å¼€å‘
- åˆæœŸ Tensor ä½œä¸º"å½±å­ç³»ç»Ÿ"è¿è¡Œï¼Œç”¨äºéªŒè¯
- é€æ­¥æ›¿æ¢åŸæœ‰é€»è¾‘
- ä¿ç•™å›é€€æœºåˆ¶

### 8.2 æ•°æ®æŒä¹…åŒ–
- SQLite ä»ä½œä¸ºæŒä¹…åŒ–å­˜å‚¨
- æ¯ N å›åˆæˆ–ä¿å­˜æ—¶å°† Tensor åŒæ­¥å›æ•°æ®åº“
- æ”¯æŒä»æ•°æ®åº“é‡å»º TensorState

### 8.3 é…ç½®å¼€å…³
```python
class TensorConfig:
    use_tensor_mortality: bool = True      # ä½¿ç”¨å¼ é‡æ­»äº¡ç‡è®¡ç®—
    use_tensor_speciation: bool = True     # ä½¿ç”¨å¼ é‡åˆ†åŒ–æ£€æµ‹
    use_auto_tradeoff: bool = True         # ä½¿ç”¨è‡ªåŠ¨ä»£ä»·è®¡ç®—
    tradeoff_ratio: float = 0.7            # ä»£ä»·/å¢ç›Šæ¯”ä¾‹

# æµ‹è¯•ä¸ç›‘æ§å»ºè®®
# - ä¸ºå¼ é‡æ­»äº¡ç‡ã€SpeciationMonitorã€TradeoffCalculator æ·»åŠ å•å…ƒä¸å›åˆçº§æµ‹è¯•
# - è®°å½•æ€§èƒ½ä¸å‡†ç¡®åº¦åŸºçº¿ï¼Œä¾¿äºåŒè½¨å¯¹æ¯”
```

---

## 9. é™„å½•ï¼šç«äº‰å…³ç³»è¡¨

ç”¨äºè‡ªåŠ¨ä»£ä»·è®¡ç®—çš„ç”Ÿç‰©å­¦ä¾æ®ï¼š

| å¢å¼ºå±æ€§ | ç«äº‰å±æ€§ï¼ˆä»£ä»·å€™é€‰ï¼‰ | ç”Ÿç‰©å­¦åŸç† |
|----------|---------------------|------------|
| è¿åŠ¨èƒ½åŠ› | ç‰©ç†é˜²å¾¡ã€ä½“å‹ã€ç¹æ®–é€Ÿåº¦ | èƒ½é‡åˆ†é…æƒè¡¡ |
| ç‰©ç†é˜²å¾¡ | è¿åŠ¨èƒ½åŠ›ã€ç¹æ®–é€Ÿåº¦ | è£…ç”²å¢é‡é™ä½çµæ´»æ€§ |
| ç¹æ®–é€Ÿåº¦ | ä½“å‹ã€å¯¿å‘½ã€æ™ºåŠ› | r/K ç­–ç•¥æƒè¡¡ |
| è€å¯’æ€§ | è€çƒ­æ€§ã€ç¹æ®–é€Ÿåº¦ | çƒ­é€‚åº”äº’æ–¥ |
| è€çƒ­æ€§ | è€å¯’æ€§ã€ç¹æ®–é€Ÿåº¦ | çƒ­é€‚åº”äº’æ–¥ |
| æ™ºåŠ› | ç¹æ®–é€Ÿåº¦ã€ä½“å‹ | å¤§è„‘èƒ½è€—é«˜ |
| å…‰åˆæ•ˆç‡ | è€æ—±æ€§ | æ°”å­”å¼€æ”¾å¢åŠ è’¸è…¾ |
| æ„ŸçŸ¥èƒ½åŠ› | ç¹æ®–é€Ÿåº¦ | ç¥ç»ç³»ç»Ÿç»´æŠ¤æˆæœ¬ |

---

## TODOï¼ˆå¼€å‘è½åœ°æ¸…å•ï¼‰
- âœ… åœ¨ TileBasedMortalityEngine å¢åŠ  TensorState åŒå†™ï¼ŒPopulationUpdateStage å›å†™ç»“æœè‡³å¼ é‡å½±å­ï¼Œä¿æŒæ—§æ¥å£ã€‚
- âœ… å®ç° SpeciationMonitor.detect_isolation/divergence å¹¶æ¥å…¥ SpeciationServiceï¼Œå¼ é‡è§¦å‘ä¿¡å·å¹¶å…¥åˆ†åŒ–å€™é€‰ï¼ŒAI åˆ†åŒ–ä¿¡å·ä¿ç•™å›é€€ã€‚
- âœ… åˆ†åŒ–ç”Ÿæˆæ¥å…¥ TradeoffCalculatorï¼ˆuse_auto_tradeoff + tradeoff_ratioï¼‰ï¼ŒLLM ä»…è¾“å‡ºåˆ›æ„ä¸å¢ç›Šï¼Œä»£ä»·/æƒè¡¡ç³»ç»Ÿè®¡ç®—ã€‚
- âœ… åœ¨ `get_default_stages` é¢„ç•™å¼ é‡é˜¶æ®µè¾“å‡ºï¼ˆSpeciationDataTransferStage ä¼ é€’ TensorStateï¼‰ï¼Œå¼ é‡æ•°æ®è´¯é€šåˆ°åˆ†åŒ–/ç§ç¾¤æ›´æ–°ã€‚
- âœ… åˆ›å»º TensorConfig é…ç½®ç±»ï¼Œç»Ÿä¸€ç®¡ç†å¼ é‡ç³»ç»Ÿå¼€å…³ã€‚
- âœ… åœ¨ Settings å’Œ SpeciationConfig ä¸­æ·»åŠ å¼ é‡é…ç½®å¼€å…³ï¼ˆuse_tensor_mortalityã€use_tensor_speciationã€use_auto_tradeoffã€tradeoff_ratioï¼‰ã€‚
- âœ… è¡¥é½æµ‹è¯•ï¼šSpeciationMonitorã€TradeoffCalculatorã€TensorStateã€TensorConfigã€TensorMetrics çš„å•å…ƒæµ‹è¯• + å›åˆçº§é›†æˆæµ‹è¯•ï¼ˆ70 ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡ï¼‰ã€‚
- âœ… æ”¶æ•› LLM è°ƒç”¨ï¼š`use_ai_pressure_response` é»˜è®¤ä¸º Falseï¼ŒAIStatusEval/AINarrative é»˜è®¤ç¦ç”¨ã€‚
- âœ… ç›‘æ§æŒ‡æ ‡ï¼šTensorMetrics + TensorMetricsCollector å®ç°æ€§èƒ½è¿½è¸ªï¼Œæ”¯æŒè€—æ—¶ã€å‘½ä¸­ç‡ã€å›é€€é¢‘æ¬¡ç»Ÿè®¡ã€‚

### å½“å‰å®Œæˆè¿›åº¦ï¼ˆä»£ç å·²è½åœ°ï¼‰
- å¼ é‡å½±å­ï¼šTileBasedMortality â†’ TensorState å¯¼å‡ºï¼›PopulationUpdateStage å†™å›å¼ é‡å½±å­åˆ†å¸ƒã€‚
- åˆ†åŒ–å¼ é‡è§¦å‘ï¼šSpeciationMonitor è§¦å‘ä¿¡å·æ³¨å…¥åˆ†åŒ–å€™é€‰ï¼›SpeciationService æ”¯æŒ tensor_stateã€‚
- è‡ªåŠ¨ä»£ä»·ï¼šTradeoffCalculator æ¥å…¥åˆ†åŒ–ç”Ÿæˆï¼Œéµå¾ªé…ç½®å¼€å…³ã€‚
- é…ç½®ç³»ç»Ÿï¼šTensorConfig é…ç½®ç±»ã€Settings/SpeciationConfig å¼ é‡å¼€å…³å·²æ·»åŠ ã€‚
- AI è·¯å¾„æ”¶æ•›ï¼š`use_ai_pressure_response` é»˜è®¤ Falseï¼ŒSimulationEngine ä» configs è¯»å–å¼€å…³ã€‚
- ç›‘æ§æŒ‡æ ‡ï¼šTensorMetricsï¼ˆå•å›åˆï¼‰ã€TensorMetricsCollectorï¼ˆè·¨å›åˆç´¯è®¡ï¼‰ï¼Œæ”¯æŒè®¡æ—¶ã€å‘½ä¸­ç‡ç»Ÿè®¡ã€‚
- æµ‹è¯•å¥—ä»¶ï¼š`backend/app/tensor/tests/` ç›®å½•ä¸‹ 70 ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡ï¼ˆå•å…ƒæµ‹è¯• + é›†æˆæµ‹è¯•ï¼‰ã€‚
- æ¨¡å—å¯¼å‡ºï¼š`backend/app/tensor/__init__.py` å¯¼å‡ºæ‰€æœ‰å…¬å…±æ¥å£ã€‚
- æ–‡æ¡£ã€é˜¶æ®µä¸²è”å·²æ›´æ–°ï¼›æœªå¼•å…¥æ–°çš„ linter é—®é¢˜ã€‚
- Prompt ç²¾ç®€ï¼šåˆ†åŒ–/æè¿° prompt å°†â€œåˆ›æ–°ç‚¹â€ç»Ÿä¸€ä¸ºâ€œæ¼”åŒ–ç‰¹å¾â€ï¼Œè¡¥å……ä¸­æ–‡ä¿—åå‘½åæç¤ºï¼Œç¦æ­¢æ— åŸºå‡†çš„ç™¾åˆ†æ¯”è¡¨è¿°ã€‚
- Prompt å›é€€å¯¹é½ï¼šç”Ÿæ€æ™ºèƒ½ä½“è¯„ä¼° prompt æ ‡è®°ä¸ºå¼ é‡å›é€€è·¯å¾„ï¼Œä»…éœ€å ä½ mortality/speciation å­—æ®µï¼Œé¿å…é‡å¤è®¡ç®—ã€‚
- Stage æ¸…ç†ï¼šç§»é™¤ AIStatusEval/AINarrative/Adaptation ç­‰æ—§å›é€€é˜¶æ®µï¼Œç®¡çº¿ä»…ä¿ç•™å¼ é‡+åˆ†åŒ–/æŠ¥å‘Šä¸»è·¯å¾„ã€‚
- å¼ é‡å‚æ•°å¤–éœ²ï¼š`tensor_balance.yaml` æš´éœ²æ¸©åº¦/æ‰©æ•£/å‡ºç”Ÿç‡/ç«äº‰/æ‰¿è½½åŠ›ç­‰å‚æ•°ï¼Œå¯éšæ—¶ä»£(turn/100)å’Œæ¤è¢«å‡å€¼åŠ¨æ€è°ƒèŠ‚ï¼Œå‰ç«¯å¯é€šè¿‡æ–‡ä»¶/é…ç½®æ›´æ–°ã€‚
- å‰ç«¯é…ç½®å…¥å£ï¼šæä¾› GET/PUT `/tensor/config` æ¥å£è¯»å–/æ›´æ–°å¼ é‡å‚æ•°ï¼Œå†™å› `tensor_balance.yaml` å¹¶çƒ­åŠ è½½ï¼Œå¼•æ“å¼€å…³åŒæ­¥ã€‚

### åç»­è®¡åˆ’ï¼ˆå¯é€‰æ‰§è¡Œï¼‰
- âœ… ç›‘æ§é›†æˆï¼šåœ¨ Pipeline é˜¶æ®µä¸­æ¥å…¥ TensorMetricsCollectorï¼Œè‡ªåŠ¨é‡‡é›†æ€§èƒ½æ•°æ®ã€‚
- å‰ç«¯å±•ç¤ºï¼šå°†å¼ é‡ç›‘æ§æŒ‡æ ‡æš´éœ²ç»™å‰ç«¯ä»ªè¡¨ç›˜ã€‚

### Phase 5 å®Œæˆè¿›åº¦ï¼ˆå¼ é‡ç®¡çº¿é˜¶æ®µå·²è½åœ°ï¼‰
- âœ… TensorMortalityStage: å¼ é‡æ­»äº¡ç‡è®¡ç®—ï¼Œä½¿ç”¨ HybridCompute.mortality()
- âœ… TensorDiffusionStage: å¼ é‡ç§ç¾¤æ‰©æ•£ï¼Œä½¿ç”¨ HybridCompute.diffusion()
- âœ… TensorReproductionStage: å¼ é‡ç¹æ®–è®¡ç®—ï¼Œä½¿ç”¨ HybridCompute.reproduction()
- âœ… TensorCompetitionStage: å¼ é‡ç§é—´ç«äº‰ï¼Œä½¿ç”¨ HybridCompute.competition()
- âœ… TensorStateSyncStage: å¼ é‡çŠ¶æ€åŒæ­¥å›æ•°æ®åº“å¯¹è±¡
- âœ… TensorMetricsStage: ç›‘æ§æŒ‡æ ‡æ”¶é›†é˜¶æ®µ
- âœ… Pipeline é›†æˆï¼šè‡ªåŠ¨åœ¨å›åˆå¼€å§‹/ç»“æŸæ—¶ç®¡ç† TensorMetricsCollector
- âœ… get_default_stages() ç°å·²åŒ…å«å¼ é‡é˜¶æ®µï¼Œå¯é€šè¿‡ include_tensor å‚æ•°æ§åˆ¶
- âœ… SimulationContext æ–°å¢ tensor_stateã€tensor_trigger_codesã€tensor_metrics å­—æ®µ
- âœ… æµ‹è¯•å¥—ä»¶ï¼š22 ä¸ªå¼ é‡é˜¶æ®µæµ‹è¯•å…¨éƒ¨é€šè¿‡

### Phase 6 å®Œæˆè¿›åº¦ï¼ˆLLM æ›¿ä»£å½»åº•åŒ–ï¼‰
- âœ… EcologicalIntelligenceStage é»˜è®¤ç¦ç”¨ LLM è°ƒç”¨ï¼ˆenable_llm_calls=Falseï¼‰
- âœ… SpeciationStage åˆ†åŒ–å€™é€‰ä¸»è¦æ¥æºæ”¹ä¸ºå¼ é‡è§¦å‘ï¼ˆtensor_trigger_codesï¼‰
- âœ… LLM speciation_signal é™çº§ä¸ºè¡¥å……æ¥æºï¼Œä¸å†æ˜¯ä¸»è¦ä¾èµ–
- âœ… æ·»åŠ è§„åˆ™å…œåº•ï¼šå½“å¼ é‡å’Œ LLM éƒ½æ— ä¿¡å·æ—¶ï¼ŒåŸºäºç§ç¾¤/æ­»äº¡ç‡æ£€æµ‹åˆ†åŒ–å€™é€‰
- âœ… ä¿ç•™çš„ LLM åŠŸèƒ½ï¼šåˆ†åŒ–æè¿°ç”Ÿæˆï¼ˆSpeciationServiceï¼‰ã€å›åˆæŠ¥å‘Šï¼ˆBuildReportStageï¼‰

### Phase 7 å®Œæˆè¿›åº¦ï¼ˆå¼ é‡-Embedding æ¨¡å—å…¼å®¹æ€§ä¼˜åŒ–ï¼‰
- âœ… TensorEmbeddingBridge æ¡¥æ¥æ¨¡å—ï¼šå°† TensorState æ•°æ®è½¬æ¢ä¸º Embedding æ’ä»¶å‹å¥½æ ¼å¼
- âœ… ç‰©ç§åˆ†å¸ƒæ•°æ®æå–ï¼š`TensorSpeciesDistribution` åŒ…å«ç§ç¾¤ã€åœ°å—ã€åˆ†å¸ƒç†µ
- âœ… ç¯å¢ƒæ•°æ®è·å–ï¼š`TensorEnvironmentProfile` åŒ…å«æ¸©åº¦ã€é™æ°´ã€æµ·æ‹”ã€æ¤è¢«
- âœ… åˆ†åŒ–ä¿¡å·ä¼ é€’ï¼š`TensorSpeciationSignal` é›†æˆ SpeciationMonitor æ£€æµ‹ç»“æœ
- âœ… Embedding æ’ä»¶åŸºç±»æ‰©å±•ï¼šæ–°å¢ `tensor_bridge`ã€`has_tensor_data`ã€`get_tensor_distribution()` ç­‰æ–¹æ³•
- âœ… tile_embedding ä¼˜åŒ–ï¼šä¼˜å…ˆä» TensorState è·å–ç‰©ç§åˆ†å¸ƒï¼Œé¿å…é‡å¤è®¡ç®—
- âœ… ancestry_embedding é›†æˆï¼š`should_speciate()` ä¼˜å…ˆä½¿ç”¨å¼ é‡åˆ†åŒ–ä¿¡å·
- âœ… EmbeddingPluginsStage åŒæ­¥ï¼šæ¯å›åˆæ‰§è¡Œå‰è‡ªåŠ¨åŒæ­¥å¼ é‡æ¡¥æ¥å™¨
- âœ… æµ‹è¯•å¥—ä»¶ï¼š10 ä¸ªå¼ é‡æ¡¥æ¥å™¨æµ‹è¯•å…¨éƒ¨é€šè¿‡

---

## 10. å¼ é‡-Embedding æ¡¥æ¥æ¶æ„

### 10.1 è®¾è®¡åŠ¨æœº

å¼ é‡ç³»ç»Ÿå’Œ Embedding æ¨¡å—åŸæœ¬å„è‡ªç‹¬ç«‹è¿è¡Œï¼š
- **å¼ é‡ç³»ç»Ÿ**ï¼šè®¡ç®—ç§ç¾¤åˆ†å¸ƒã€æ­»äº¡ç‡ã€åˆ†åŒ–ä¿¡å·ç­‰æ•°å€¼
- **Embedding æ¨¡å—**ï¼šæ„å»ºç‰©ç§å‘é‡ç´¢å¼•ï¼Œæ”¯æŒè¯­ä¹‰æœç´¢å’Œç›¸ä¼¼åº¦è®¡ç®—

ä¸¤è€…ä¹‹é—´å­˜åœ¨æ•°æ®é‡å¤è®¡ç®—çš„é—®é¢˜ï¼š
1. tile_embedding æ’ä»¶é‡æ–°ä» Species å¯¹è±¡è§£æç‰©ç§åˆ†å¸ƒ
2. ancestry_embedding æ’ä»¶ç‹¬ç«‹å®ç°åˆ†åŒ–æ£€æµ‹é€»è¾‘
3. ç¯å¢ƒæ•°æ®åœ¨ä¸¤ä¸ªç³»ç»Ÿä¸­åˆ†åˆ«æå–

### 10.2 æ¡¥æ¥æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     SimulationContext                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚tensor_state â”‚    â”‚tensor_trigger_  â”‚    â”‚  all_species   â”‚   â”‚
â”‚  â”‚ (TensorState)â”‚    â”‚codes (set)      â”‚    â”‚  all_tiles     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚         â”‚                    â”‚                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                    â”‚
          â–¼                    â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚        TensorEmbeddingBridge        â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚  â”‚ _species_distributions      â”‚   â”‚  â—„â”€â”€ ä» TensorState.pop æå–
    â”‚  â”‚ _environment_profiles       â”‚   â”‚  â—„â”€â”€ ä» TensorState.env æå–
    â”‚  â”‚ _speciation_signals         â”‚   â”‚  â—„â”€â”€ ä» SpeciationMonitor è·å–
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â–¼           â–¼           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚tile_biome â”‚ â”‚ ancestry  â”‚ â”‚ food_web  â”‚
    â”‚  plugin   â”‚ â”‚  plugin   â”‚ â”‚  plugin   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 10.3 æ ¸å¿ƒæ•°æ®ç»“æ„

```python
@dataclass
class TensorSpeciesDistribution:
    """ç‰©ç§åˆ†å¸ƒæ•°æ®ï¼ˆä»å¼ é‡æå–ï¼‰"""
    lineage_code: str
    total_population: int
    tile_populations: Dict[str, int]  # {tile_id: population}
    occupied_tiles: List[str]
    max_population_tile: Optional[str]
    distribution_entropy: float  # åˆ†å¸ƒå‡åŒ€åº¦ (0-1)

@dataclass
class TensorEnvironmentProfile:
    """ç¯å¢ƒå‰–é¢æ•°æ®ï¼ˆä»å¼ é‡æå–ï¼‰"""
    tile_id: str
    temperature: float
    precipitation: float
    elevation: float
    vegetation: float
    species_count: int

@dataclass
class TensorSpeciationSignal:
    """åˆ†åŒ–ä¿¡å·æ•°æ®ï¼ˆä»å¼ é‡æ£€æµ‹ï¼‰"""
    lineage_code: str
    signal_type: str  # geographic_isolation | ecological_divergence
    strength: float
    region_count: int
    divergence_score: float
```

### 10.4 æ’ä»¶åŸºç±»æ‰©å±•

```python
class EmbeddingPlugin(ABC):
    # æ–°å¢ç±»å±æ€§
    use_tensor_data: bool = True  # æ˜¯å¦å¯ç”¨å¼ é‡æ•°æ®
    
    # æ–°å¢å±æ€§
    @property
    def tensor_bridge(self) -> Optional[TensorEmbeddingBridge]:
        """è·å–å¼ é‡æ¡¥æ¥å™¨"""
    
    @property
    def has_tensor_data(self) -> bool:
        """æ˜¯å¦æœ‰å¯ç”¨çš„å¼ é‡æ•°æ®"""
    
    # æ–°å¢æ–¹æ³•
    def get_tensor_distribution(self, lineage_code: str) -> Optional[TensorSpeciesDistribution]:
        """è·å–ç‰©ç§çš„å¼ é‡åˆ†å¸ƒæ•°æ®"""
    
    def get_tensor_tile_species(self, tile_id: str) -> list[str]:
        """è·å–åœ°å—ä¸Šçš„ç‰©ç§åˆ—è¡¨"""
    
    def has_tensor_speciation_signal(self, lineage_code: str) -> bool:
        """æ£€æŸ¥ç‰©ç§æ˜¯å¦æœ‰å¼ é‡åˆ†åŒ–ä¿¡å·"""
    
    def get_tensor_divergence_score(self, lineage_code: str) -> float:
        """è·å–ç‰©ç§çš„ç”Ÿæ€åˆ†åŒ–å¾—åˆ†"""
```

### 10.5 ä½¿ç”¨ç¤ºä¾‹

```python
# åœ¨ tile_embedding ä¸­ä¼˜å…ˆä½¿ç”¨å¼ é‡æ•°æ®
class TileBiomePlugin(EmbeddingPlugin):
    use_tensor_data = True  # å¯ç”¨å¼ é‡é›†æˆ
    
    def build_tile_profiles(self, ctx):
        # ä¼˜å…ˆä»å¼ é‡è·å–ç‰©ç§åˆ†å¸ƒ
        if self.has_tensor_data:
            species_dist = self.tensor_bridge.to_legacy_species_distribution()
            # ç›´æ¥ä½¿ç”¨ï¼Œé¿å…é‡å¤è§£æ Species å¯¹è±¡
        else:
            # å›é€€åˆ°ä¼ ç»Ÿæ–¹å¼
            ...

# åœ¨ ancestry_embedding ä¸­ä½¿ç”¨å¼ é‡åˆ†åŒ–ä¿¡å·
class AncestryEmbeddingPlugin(EmbeddingPlugin):
    def should_speciate(self, species, threshold=0.6):
        # ä¼˜å…ˆä½¿ç”¨å¼ é‡åˆ†åŒ–ä¿¡å·
        if self.has_tensor_speciation_signal(species.lineage_code):
            regions = self.tensor_bridge.get_species_isolation_regions(species.lineage_code)
            divergence = self.tensor_bridge.get_species_divergence_score(species.lineage_code)
            
            return {
                "should_speciate": regions >= 2 or divergence >= threshold,
                "tensor_triggered": True,
                "isolation_regions": regions,
                "divergence_score": divergence,
            }
        
        # å›é€€åˆ°è¡€ç»Ÿå‘é‡è·ç¦»
        ...
```

### 10.6 æ€§èƒ½ä¼˜åŒ–æ•ˆæœ

| åœºæ™¯ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | è¯´æ˜ |
|------|--------|--------|------|
| ç‰©ç§åˆ†å¸ƒè®¡ç®— | æ¯æ’ä»¶ç‹¬ç«‹è§£æ | å¤ç”¨å¼ é‡æ•°æ® | é¿å… N æ¬¡é‡å¤éå† |
| åˆ†åŒ–æ£€æµ‹ | embedding + tensor å„ä¸€æ¬¡ | ä»… tensor | ç»Ÿä¸€æ£€æµ‹å…¥å£ |
| ç¯å¢ƒæ•°æ®è·å– | ä» Context æå– | ä»å¼ é‡æå– | æ•°æ®æ ¼å¼ç»Ÿä¸€ |

---

## 11. NumPy + Taichi æ··åˆè®¡ç®—

### 11.1 åˆ†å·¥ç­–ç•¥

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Taichi è´Ÿè´£ï¼ˆGPU/CUDAï¼‰                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ mortality()     - æ­»äº¡ç‡è®¡ç®—ï¼Œéœ€è¦éå†æ‰€æœ‰æ ¼å­                 â”‚
â”‚ â€¢ diffusion()     - ç§ç¾¤æ‰©æ•£ï¼Œç©ºé—´é‚»å±…è®¡ç®—                      â”‚
â”‚ â€¢ reproduction()  - ç¹æ®–è®¡ç®—ï¼Œæ‰¿è½½åŠ›å’Œå¯†åº¦ä¾èµ–                   â”‚
â”‚ â€¢ competition()   - ç§é—´ç«äº‰ï¼Œå¤šç‰©ç§äº¤äº’                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  NumPy è´Ÿè´£ï¼ˆCPUï¼‰                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ sum_population()      - èšåˆç»Ÿè®¡ï¼Œç®€å•å½’çº¦                    â”‚
â”‚ â€¢ mean_population()     - å¹³å‡å€¼è®¡ç®—                           â”‚
â”‚ â€¢ filter_alive()        - æ¡ä»¶ç­›é€‰                             â”‚
â”‚ â€¢ get_presence_mask()   - æ©ç ç”Ÿæˆ                             â”‚
â”‚ â€¢ normalize_population()- å½’ä¸€åŒ–                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 11.2 æ€§èƒ½å¯¹æ¯”

| è§„æ¨¡ (ç‰©ç§, H, W) | NumPy æ€»è€—æ—¶ | Taichi æ€»è€—æ—¶ | åŠ é€Ÿæ¯” |
|-------------------|--------------|---------------|--------|
| (10, 64, 64)      | 0.6 ms       | 0.9 ms        | 0.7x   |
| (20, 128, 128)    | 4.6 ms       | 2.1 ms        | **2.1x** |
| (50, 256, 256)    | 41.6 ms      | 12.1 ms       | **3.4x** |
| (100, 512, 512)   | 370.7 ms     | 89.1 ms       | **4.1x** |

> å°è§„æ¨¡æ—¶ NumPy æ›´å¿«ï¼ˆGPU é€šä¿¡å¼€é”€ï¼‰ï¼Œä¸­å¤§è§„æ¨¡ Taichi æ˜¾è‘—åŠ é€Ÿã€‚

### 11.3 ä½¿ç”¨æ–¹å¼

```python
from app.tensor import HybridCompute, get_compute

# è·å–å…¨å±€å®ä¾‹ï¼ˆæ¨èï¼‰
compute = get_compute()

# æˆ–åˆ›å»ºæ–°å®ä¾‹
compute = HybridCompute(arch="auto")  # auto/gpu/cuda/cpu

# æ£€æŸ¥åç«¯
print(compute.backend)  # "taichi" æˆ– "numpy"

# Taichi åŠ é€Ÿæ“ä½œ
mortality = compute.mortality(pop, env, params)
new_pop = compute.diffusion(pop, rate=0.1)
after_death = compute.apply_mortality(pop, mortality)

# NumPy ç®€å•æ“ä½œ
totals = compute.sum_population(pop)
alive_species = compute.filter_alive(pop, threshold=100)
```

### 11.4 æŠ€æœ¯è¦æ±‚

- **Taichi**: éœ€è¦ Python 3.12 æˆ–æ›´ä½ç‰ˆæœ¬
- **GPU**: è‡ªåŠ¨æ£€æµ‹ CUDA/Vulkanï¼Œå›é€€åˆ° CPU
- **NumPy å›é€€**: Taichi ä¸å¯ç”¨æ—¶è‡ªåŠ¨ä½¿ç”¨ NumPy

---

## 12. å‹åŠ›-å¼ é‡æ¡¥æ¥æ¶æ„

### 12.1 é—®é¢˜èƒŒæ™¯

å½“å‰ç³»ç»Ÿå­˜åœ¨å‹åŠ›ä¼ é€’æ–­è£‚ï¼š

```
å‹åŠ›ç³»ç»Ÿ:
  ParsePressuresStage â†’ ctx.modifiers = {
    "temperature": -2.4,
    "drought": 0.3,
    "volcanic": 5.0,
    "sulfide": 2.0,
    ...40+ ç§ä¿®æ”¹å™¨
  }
        â†“
  TileBasedMortalityEngine (ä½¿ç”¨ modifiers)

å¼ é‡ç³»ç»Ÿ:
  TensorMortalityStage
        â†“
  HybridCompute.mortality(temp_idx=1, temp_opt, temp_tol)
        â†“
  âŒ åªç”¨æ¸©åº¦é€šé“ï¼Œå®Œå…¨å¿½ç•¥ ctx.modifiersï¼
```

**æ ¸å¿ƒé—®é¢˜**ï¼šå‹åŠ›ä¿®æ”¹å™¨æ²¡æœ‰ä¼ é€’åˆ°å¼ é‡è®¡ç®—é˜¶æ®µï¼Œå¯¼è‡´å¼ é‡æ­»äº¡ç‡è®¡ç®—ä¸å®é™…å‹åŠ›è„±èŠ‚ã€‚

### 12.2 æ¡¥æ¥æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       å‹åŠ› â†’ å¼ é‡æ¡¥æ¥æ¶æ„                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              PressureToTensorBridge                                  â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  è¾“å…¥: ctx.modifiers, ctx.pressures                                 â”‚   â”‚
â”‚  â”‚  è¾“å‡º: pressure_overlay (P, H, W)                                   â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  å‹åŠ›é€šé“:                                                          â”‚   â”‚
â”‚  â”‚    [0] THERMAL   - æ¸©åº¦å‹åŠ› (temperature, volcanic cooling)         â”‚   â”‚
â”‚  â”‚    [1] DROUGHT   - å¹²æ—±å‹åŠ› (drought, resource_decline)             â”‚   â”‚
â”‚  â”‚    [2] TOXIN     - æ¯’æ€§å‹åŠ› (sulfide, acidity, toxin_level)         â”‚   â”‚
â”‚  â”‚    [3] OXYGEN    - æ°§æ°”å‹åŠ› (oxygen, anoxic)                        â”‚   â”‚
â”‚  â”‚    [4] DIRECT    - ç›´æ¥æ­»äº¡ (mortality_spike, storm_damage)         â”‚   â”‚
â”‚  â”‚    [5] RADIATION - è¾å°„å‹åŠ› (uv_radiation, dna_damage)              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â†“                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              SpeciesParamsExtractor                                  â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  è¾“å…¥: Species.abstract_traits                                      â”‚   â”‚
â”‚  â”‚  è¾“å‡º: species_params (S, F) æ‰©å±•                                   â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  å‚æ•°ç´¢å¼•:                                                          â”‚   â”‚
â”‚  â”‚    [0] cold_res    - è€å¯’æ€§                                        â”‚   â”‚
â”‚  â”‚    [1] heat_res    - è€çƒ­æ€§                                        â”‚   â”‚
â”‚  â”‚    [2] drought_res - è€æ—±æ€§                                        â”‚   â”‚
â”‚  â”‚    [3] acid_res    - è€é…¸ç¢±æ€§                                      â”‚   â”‚
â”‚  â”‚    [4] oxygen_need - æ°§æ°”éœ€æ±‚                                      â”‚   â”‚
â”‚  â”‚    [5] repro_rate  - ç¹æ®–é€Ÿåº¦                                      â”‚   â”‚
â”‚  â”‚    [6] mobility    - è¿åŠ¨èƒ½åŠ›                                      â”‚   â”‚
â”‚  â”‚    [7] toxin_res   - æ¯’æ€§æŠ—æ€§ (æ´¾ç”Ÿ)                                â”‚   â”‚
â”‚  â”‚    [8] sensitivity - åŸºç¡€æ•æ„Ÿåº¦ (æ´¾ç”Ÿ)                              â”‚   â”‚
â”‚  â”‚    [9] is_autotroph - è‡ªå…»æ ‡è®°                                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â†“                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              MultiFactorMortality                                    â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  å…¬å¼: mortality = 1 - Î (1 - stress_i Ã— (1 - resistance_i))         â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  å› å­:                                                              â”‚   â”‚
â”‚  â”‚    - thermal_stress  (æ¸©åº¦åç¦» Ã— è€å¯’/è€çƒ­æŠ—æ€§)                     â”‚   â”‚
â”‚  â”‚    - drought_stress  (å¹²æ—±å‹åŠ› Ã— è€æ—±æŠ—æ€§)                          â”‚   â”‚
â”‚  â”‚    - toxin_stress    (æ¯’æ€§å‹åŠ› Ã— æ¯’æ€§æŠ—æ€§)                          â”‚   â”‚
â”‚  â”‚    - oxygen_stress   (ç¼ºæ°§å‹åŠ› Ã— æ°§æ°”éœ€æ±‚)                          â”‚   â”‚
â”‚  â”‚    - direct_mortality(ç›´æ¥æ­»äº¡ä¿®æ­£)                                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 12.3 ä¿®æ”¹å™¨-é€šé“æ˜ å°„è¡¨

| ä¿®æ”¹å™¨ | é€šé“ | ç³»æ•° | è¯´æ˜ |
|--------|------|------|------|
| temperature | THERMAL | 1.0 | æ¸©åº¦å˜åŒ– |
| volcanic | THERMAL | -0.5 | ç«å±±ç°é™æ¸© |
| drought | DROUGHT | 1.0 | å¹²æ—± |
| resource_decline | DROUGHT | 0.5 | èµ„æºè¡°é€€ |
| wildfire_risk | DROUGHT | 0.3 | é‡ç«é£é™© |
| sulfide | TOXIN | 1.0 | ç¡«åŒ–ç‰© |
| toxin_level | TOXIN | 0.8 | æ¯’ç´ æ°´å¹³ |
| acidity | TOXIN | 0.6 | é…¸åº¦ |
| sulfur_aerosol | TOXIN | 0.7 | ç¡«é…¸ç›æ°”æº¶èƒ¶ |
| oxygen | OXYGEN | -1.0 | æ°§æ°”å˜åŒ–ï¼ˆè´Ÿ=ç¼ºæ°§ï¼‰ |
| deep_water_anoxia | OXYGEN | 1.0 | æ·±æ°´ç¼ºæ°§ |
| mortality_spike | DIRECT | 1.0 | ç›´æ¥æ­»äº¡ |
| storm_damage | DIRECT | 0.5 | é£æš´æŸä¼¤ |
| uv_radiation | RADIATION | 1.0 | ç´«å¤–è¾å°„ |
| dna_damage | RADIATION | 0.8 | DNAæŸä¼¤ |

### 12.4 ç‰©ç§æŠ—æ€§è®¡ç®—è§„åˆ™

**æ¯’æ€§æŠ—æ€§æ´¾ç”Ÿå…¬å¼**ï¼š
```python
toxin_res = base_acid_res
if diet_type == "autotroph" and habitat_type == "deep_sea":
    toxin_res += 0.3  # åŒ–èƒ½è‡ªå…»åŠ æˆ
if oxygen_need < 3.0:
    toxin_res += 0.2  # åŒæ°§é€‚åº”åŠ æˆ
toxin_res = min(1.0, toxin_res)
```

**åŸºç¡€æ•æ„Ÿåº¦å…¬å¼**ï¼š
```python
sensitivity = 1.0 - (0.3 * mobility + 0.2 * repro_rate)
# é«˜è¿åŠ¨èƒ½åŠ›å’Œç¹æ®–é€Ÿåº¦çš„ç‰©ç§æ¢å¤æ›´å¿«
```

### 12.5 æ­»äº¡ç‡ç»„åˆå…¬å¼

```python
# å„å› å­ç‹¬ç«‹è®¡ç®—
thermal_stress = compute_thermal(temp, pressure[THERMAL], cold_res, heat_res)
drought_stress = compute_drought(pressure[DROUGHT], drought_res)
toxin_stress = compute_toxin(pressure[TOXIN], toxin_res, is_autotroph)
oxygen_stress = compute_oxygen(pressure[OXYGEN], oxygen_need)
direct_mortality = pressure[DIRECT] * 0.1

# ä¹˜æ³•ç»„åˆï¼ˆå…è®¸å åŠ ä½†ä¸çˆ†ç‚¸ï¼‰
survival = (1 - thermal) * (1 - drought) * (1 - toxin) * (1 - oxygen) * (1 - direct)
mortality = 1 - survival
mortality = clip(mortality, 0.01, 0.99)
```

### 12.6 ç®¡çº¿é›†æˆ

æ–°å¢é˜¶æ®µ `PressureTensorStage`ï¼ˆorder=11ï¼‰ï¼š

```
ParsePressuresStage (order=10)
    â†“ ctx.modifiers, ctx.pressures
PressureTensorStage (order=11)  â† æ–°å¢
    â†“ ctx.pressure_overlay
...
TensorMortalityStage (order=81)
    â†“ ä½¿ç”¨ ctx.pressure_overlay è®¡ç®—å¤šå› å­æ­»äº¡ç‡
```

### 12.7 é…ç½®å‚æ•°

```yaml
# tensor_balance.yaml
pressure_bridge:
  # æ¸©åº¦å‹åŠ›
  thermal_multiplier: 5.0        # æ¯å•ä½å‹åŠ›=5Â°Cæ¸©åº¦å˜åŒ–
  
  # æ¯’æ€§å‹åŠ›
  toxin_base_mortality: 0.2      # æ¯å•ä½æ¯’æ€§=20%åŸºç¡€æ­»äº¡ç‡
  autotroph_toxin_benefit: 0.3   # åŒ–èƒ½è‡ªå…»å—ç›Šç³»æ•°
  
  # å¹²æ—±å‹åŠ›
  drought_base_mortality: 0.15   # æ¯å•ä½å¹²æ—±=15%åŸºç¡€æ­»äº¡ç‡
  
  # ç¼ºæ°§å‹åŠ›
  anoxic_base_mortality: 0.25    # æ¯å•ä½ç¼ºæ°§=25%åŸºç¡€æ­»äº¡ç‡
  aerobe_sensitivity: 0.8        # éœ€æ°§ç”Ÿç‰©æ•æ„Ÿåº¦
  
  # ç›´æ¥æ­»äº¡
  direct_mortality_rate: 0.1     # æ¯å•ä½=10%æ­»äº¡ç‡
  
  # è¾å°„å‹åŠ›
  radiation_base_mortality: 0.12 # æ¯å•ä½è¾å°„=12%åŸºç¡€æ­»äº¡ç‡
```

### 12.8 é¢„æœŸæ•ˆæœ

| æŒ‡æ ‡ | æ”¹è¿›å‰ | æ”¹è¿›å |
|------|--------|--------|
| å‹åŠ›ä¼ é€’ç‡ | 0%ï¼ˆå¼ é‡å¿½ç•¥modifiersï¼‰ | 95%+ |
| ç‰©ç§å·®å¼‚åŒ– | ä»…æ¸©åº¦ | å¤šå› å­+æŠ—æ€§ |
| åŒºåŸŸå‹åŠ›æ”¯æŒ | å¦ | æ˜¯ï¼ˆç©ºé—´æ©ç ï¼‰ |
| åŒ–èƒ½è‡ªå…»ç”Ÿç‰© | ä¸æ™®é€šç”Ÿç‰©åŒç­‰ | ç¡«åŒ–äº‹ä»¶å—ç›Š |

---

## TODOï¼ˆå‹åŠ›æ¡¥æ¥å¼€å‘æ¸…å•ï¼‰

- [x] P0: å®ç° `PressureToTensorBridge` - å‹åŠ›ä¿®æ”¹å™¨â†’å¼ é‡è½¬æ¢
- [x] P1: å®ç° `SpeciesParamsExtractor` - ç‰©ç§ç‰¹è´¨â†’å‚æ•°çŸ©é˜µ
- [x] P2: å®ç° `MultiFactorMortality` - å¤šå› å­æ­»äº¡ç‡å…¬å¼
- [x] P3: å®ç° `PressureTensorStage` + ç®¡çº¿é›†æˆ
- [x] æ›´æ–° `tensor_balance.yaml` é…ç½®
- [x] é›†æˆæµ‹è¯•å’ŒéªŒè¯ï¼ˆ142 ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡ï¼‰

### å®ç°æ–‡ä»¶æ¸…å•

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `backend/app/tensor/pressure_bridge.py` | å‹åŠ›æ¡¥æ¥æ ¸å¿ƒæ¨¡å— |
| `backend/app/simulation/tensor_stages.py` | æ–°å¢ `PressureTensorStage`ï¼Œä¿®æ”¹ `TensorMortalityStage` |
| `backend/app/simulation/context.py` | æ–°å¢ `pressure_overlay` å­—æ®µ |
| `backend/app/tensor/__init__.py` | å¯¼å‡ºæ–°æ¨¡å— |
| `backend/app/config/tensor_balance.yaml` | æ–°å¢ `pressure_bridge` é…ç½®èŠ‚ |
| `backend/app/tensor/tests/test_pressure_bridge.py` | 21 ä¸ªå•å…ƒæµ‹è¯• |